---
id: BD-ADR-020
title: タグ原本をDB正本とし利用者向けJSON配信を分離する
doc_type: アーキテクチャ決定記録
phase: BD
version: 1.0.0
status: 下書き
owner: RQ-SH-001
created: 2026-02-11
updated: '2026-02-11'
up:
- '[[RQ-RDR-031]]'
related:
- '[[RQ-FR-005]]'
- '[[RQ-FR-009]]'
- '[[RQ-UC-004]]'
- '[[RQ-GL-005]]'
- '[[RQ-GL-014]]'
- '[[BD-API-001]]'
- '[[BD-DATA-001]]'
tags:
- diopside
- BD
- ADR
---

## 決定事項
- [[RQ-GL-005|タグ辞書]]の正本はDBで管理し、[[RQ-SH-001|管理者]]の操作は管理画面経由の更新APIで受け付ける。
- 利用者向け参照は、DB正本から生成した静的JSON（`tag_master.json`）を読み取る方式を標準とする。
- 利用者アクセス時の都度再生成は採用せず、更新イベント起点または定期バッチでJSONを再生成して配信領域へ反映する。
- 将来の高度検索/チャット欄検索は、DB正本を起点に検索系（RDB検索または専用インデックス）へ拡張可能な構成を採用する。

## 理由
- JSONのみを正本にすると、履歴管理、整合性担保、複合条件検索の拡張で運用負荷が増大する。
- DB正本と配信JSONを分離することで、更新系の正確性と参照系の配信性能を両立できる。
- リクエスト都度再生成を避けることで、ピーク時の遅延増加と同時実行競合のリスクを抑制できる。
- 検索要件の拡張時に、配信契約を維持しつつ検索基盤だけを段階導入できる。

## 影響
- API設計: [[BD-API-001]] の `tag_master.json` 契約に、生成タイミングと反映境界（更新系/参照系分離）を追記する。
- データ設計: [[BD-DATA-001]] にタグ正本管理層（履歴・状態・有効/無効）と配信成果層への反映フローを追記する。
- 要求整合: [[RQ-FR-005]] と [[RQ-FR-009]] の要求本文を、本決定に沿って更新可能な状態にする。
- ユースケース整合: [[RQ-UC-004]] の参照元記述を、配信JSONと将来検索基盤の境界に合わせる。

## 却下した選択肢
- タグ原本を静的JSONのみで管理する案: 履歴追跡と検索拡張の負荷が高いため不採用。
- 利用者リクエスト時にJSONを都度再生成する案: レイテンシ増加と同時実行競合のリスクが高いため不採用。
- 利用者向けを全面動的APIに切り替える案: 現行の静的配信メリット（単純性/低運用コスト）を失うため不採用。

## 変更履歴
- 2026-02-11: 新規作成 [[BD-ADR-020]]
