---
id: BD-SYS-ADR-019
title: ビルドをデプロイ単位で分離して品質ゲートを固定する
doc_type: アーキテクチャ決定記録
phase: BD
version: 1.0.0
status: 下書き
owner: RQ-SH-001
created: 2026-02-11
updated: '2026-02-11'
up:
- '[[RQ-RDR-025]]'
related:
- '[[RQ-DEV-001]]'
- '[[BD-DEV-PIPE-001]]'
- '[[BD-INF-DEP-003]]'
- '[[BD-INF-DEP-004]]'
- '[[BD-APP-API-004]]'
tags:
- diopside
- BD
- ADR
---

## 決定事項
- ビルド責務を「ドキュメント」「フロントエンド」「バックエンド」「インフラ」の4つのデプロイ単位で分離する。
- 各単位は成果物、配信経路、失敗条件、再実行範囲を固定し、単位をまたぐ暗黙依存を許可しない。
- 共通ゲート（`lint` / `test` / `build`）に加えて単位固有ゲートを必須化する。
  - docs: `task docs:guard`、Quartz build、`siteAssetPath` 整合
  - web: `typecheck` / `test` / `build`
  - api: `/api/v1/*` と `/openapi/v1/openapi.json` の版整合、rewrite非適用
  - infra: `cdk synth` 決定性、`cdk-nag` 合格

## 理由
- 単一の「build成功」判定では、どの配備単位が失敗したかを特定しづらく、復旧時間が伸びる。
- 配信経路が `/web/*`、`/docs/*`、`/openapi/*`、`/api/v1/*` に分離されているため、ビルド責務も同じ単位で揃える必要がある。
- 単位別ゲートを固定すると、回帰時に影響範囲を限定した再実行が可能になり、小差分リリースの安定性を高められる。

## 影響
- ビルド設計: [[BD-DEV-PIPE-001]] に単位別方針、成果物、ゲート、受入条件を追加する。
- デプロイ設計: [[BD-INF-DEP-003]] / [[BD-INF-DEP-004]] の経路分離とビルド責務の対応を明確化する。
- API設計: [[BD-APP-API-004]] の版境界をバックエンド単位のビルド受入条件へ反映する。

## 却下した選択肢
- 単一ビルド定義のまま運用する案: 障害時の切り分けが遅く、部分再実行が曖昧になるため不採用。
- docs/web/api/infra を同一成果物として扱う案: 配信経路の責務境界と矛盾し、誤配備リスクが高まるため不採用。

## 変更履歴
- 2026-02-11: 新規作成 [[BD-SYS-ADR-019]]
