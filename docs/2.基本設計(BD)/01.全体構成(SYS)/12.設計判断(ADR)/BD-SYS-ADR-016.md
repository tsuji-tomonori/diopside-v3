---
id: BD-SYS-ADR-016
title: AIエージェント運用で最小権限と段階解放を採用する
doc_type: アーキテクチャ決定記録
phase: BD
version: 1.0.1
status: 下書き
owner: RQ-SH-001
created: 2026-02-11
updated: '2026-02-23'
up:
- '[[RQ-RDR-029]]'
related:
- '[[RQ-DEV-002-01]]'
- '[[BD-SYS-ARCH-005]]'
- '[[BD-INF-CM-001]]'
- '[[RQ-DG-001]]'
tags:
- diopside
- BD
- ADR
---

## 決定事項
- AIエージェント運用は、役割ごとの最小権限を標準とし、編集・実行を必要時にのみ段階解放する。
- レビュー/監査責務のエージェントは `edit` を禁止し、差分確認に必要な読み取り操作のみ許可する。
- サブエージェント起動はホワイトリスト化し、未定義呼び出しを許可しない。
- 調査系エージェントにはステップ上限を設定し、上限到達時は未完了タスクを明示する。
- ヘッドレス環境ではOAuth認証キャッシュをジョブ内でのみ復元し、終了時に破棄する。

## 理由
- AI支援開発前提では、権限過多な単一運用より責務分離の方が安全性と再現性を両立できる。
- 読み取り専用と編集可能の境界を固定することで、意図しない変更を予防できる。
- 呼び出し先と実行上限を固定すると、オーケストレーションの暴走とコスト超過を抑制できる。

## 影響
- 要求: [[RQ-DEV-002-01]] の受入基準を実装可能な設計に変換する。
- 構成: [[BD-SYS-ARCH-005]] に責務分離、呼び出し制限、成果物の受け渡し経路を反映する。
- 運用: [[BD-INF-CM-001]] と [[RQ-DG-001]] の文書更新フローに沿って、判断記録と整合チェックを必須化する。
- セキュリティ: 認証情報の永続配置を避けるため、実行ジョブごとの復元/破棄手順を運用手順へ反映する。

## 却下した選択肢
- 全エージェントへ編集/実行権限を常時付与する案: 誤操作リスクが高く、レビュー工程の独立性を担保できないため不採用。
- エージェントを分割せず単一汎用エージェントで運用する案: 専門観点の網羅性と権限制御の明確性が不足するため不採用。
- 実行ステップ上限を設定しない案: 調査系タスクの終了条件が曖昧になり、運用コストを制御できないため不採用。

## 変更履歴
- 2026-02-23: ヘッドレス実行時のOAuth認証キャッシュ復元/破棄方針を追加 [[BD-SYS-ADR-016]]
- 2026-02-11: 新規作成
