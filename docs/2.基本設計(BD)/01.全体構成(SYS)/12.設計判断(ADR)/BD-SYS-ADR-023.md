---
id: BD-SYS-ADR-023
title: HTTP API契約をRFC準拠で統一する
doc_type: アーキテクチャ決定記録
phase: BD
version: 1.0.0
status: 下書き
owner: RQ-SH-001
created: 2026-02-11
updated: '2026-02-11'
up:
- '[[RQ-INT-001]]'
- '[[RQ-SEC-001]]'
- '[[RQ-OBY-001]]'
related:
- '[[BD-APP-API-005]]'
- '[[BD-APP-API-002]]'
- '[[BD-APP-API-003]]'
- '[[BD-APP-API-004]]'
- '[[DD-APP-ERR-001]]'
- '[[DD-APP-API-001]]'
tags:
- diopside
- BD
- ADR
---

## 決定事項
- 管理画面向け更新系APIの共通契約を、HTTPセマンティクス/エラー/ページング/互換性/可観測性の観点で統一する。
- エラー応答は Problem Details（`application/problem+json`）を標準とし、拡張項目で業務コードと再試行可否を表現する。
- 一覧取得はページング必須とし、大規模データではカーソル方式（opaque cursor）を採用する。
- OpenAPIを契約正本とし、Lint・破壊的変更検知・コントラクトテストをCIの必須ゲートにする。
- 廃止は仕様明記（`deprecated: true`）と移行期間確保を必須とし、可能な範囲で `Deprecation`/`Sunset` ヘッダを返す。

## 理由
- API[[RQ-SH-002|利用者]]にとって予測可能なI/Fを維持し、画面実装/運用自動化の学習コストを抑えられる。
- ステータスコードとエラー形式の統一により、障害時の原因切り分けと運用判断を自動化しやすい。
- 破壊的変更を早期に検知することで、公開後の互換事故と復旧コストを低減できる。

## 影響
- 基本設計: [[BD-APP-API-005]] を新設し、HTTP API契約の共通規約を明文化する。
- [[BD-APP-API-002|収集API設計]]: [[BD-APP-API-002]] で共通契約適用（メソッド意味論、429運用、Problem Details）を追記する。
- [[BD-APP-API-003|エラーモデル]]: [[BD-APP-API-003]] を Problem Details 基準へ更新する。
- バージョン境界: [[BD-APP-API-004]] へ SemVer/廃止運用/CI契約検証を反映する。
- 詳細設計: [[DD-APP-ERR-001]] / [[DD-APP-API-001]] で実装レベルの応答マッピングとテスト観点を更新する。

## 却下した選択肢
- サービスごとに独自エラー形式を継続する案: [[RQ-SH-002|利用者]]実装と運用監視の複雑性が高いため不採用。
- オフセットページングを標準化する案: 大規模データで重複/欠落のリスクが高いため不採用。
- OpenAPIを参考資料扱いにする案: 契約差分の検知が遅れ、互換性事故リスクが高いため不採用。

## 変更履歴
- 2026-02-11: 新規作成（HTTP API契約統一方針の決定） [[BD-SYS-ADR-023]]
