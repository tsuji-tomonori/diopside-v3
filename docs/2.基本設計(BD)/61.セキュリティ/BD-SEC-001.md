---
id: BD-SEC-001
title: セキュリティ設計
doc_type: セキュリティ設計
phase: BD
version: 1.0.3
status: 下書き
owner: RQ-SH-001
created: 2026-01-31
updated: '2026-02-11'
up:
- '[[RQ-SC-001]]'
- '[[RQ-SEC-001]]'
- '[[RQ-DEV-001]]'
related:
- '[[BD-ARCH-001]]'
- '[[BD-ADR-001]]'
- '[[BD-ADR-024]]'
- '[[BD-API-004]]'
- '[[BD-BUILD-001]]'
- '[[DD-SEC-001]]'
- '[[AT-OPS-001]]'
- '[[RQ-UX-022]]'
tags:
- diopside
- BD
- SEC
---


## 設計方針
- 公開データのみを扱う前提を維持しつつ、Next.js App Router の Server/Client 境界をセキュリティ境界として明示する。
- 更新系の信頼境界は `管理画面 -> Backend API -> DB` に固定し、公開配信系（`/web/*`, `/docs/*`）へ機密情報を混在させない。
- 認証・認可、入力検証、秘密情報管理、監査ログを「実装任せ」にせず、BD段階で[[RQ-GL-012|受入判定]]可能な統制として定義する。

## セキュリティ設計要点
### データアクセス境界（RSC時代の前提）
- Server Components で扱うデータは「公開可能」と「内部限定」を区分し、内部限定データを Client Components のpropsへ直接渡さない。
- Dynamic API（`cookies()` / `headers()`）で取得する認証・セッション情報は、cached scope内で参照せず、必要最小限の値だけを引数として受け渡す。
- Server Actions は呼び出し元を信頼せず、アクション内で毎回認可チェックを実施する。

### 認証・認可境界
- `'/openapi/*'` と `'/api/v1/*'` は認証必須とし、未認証・未認可アクセスでは 2xx 応答を返さない。
- 管理系操作（収集実行、[[RQ-GL-011|再収集]]、タグ更新、公開反映）は権限検証を通過した要求のみ実行可能とする。
- Route Handlers は Client からの更新入口として利用し、Server から Route Handlers を経由する自己HTTP呼び出しは採用しない。

### 秘密情報と設定管理
- `.env.*` はリポジトリへコミットしない。公開可能な設定のみ `NEXT_PUBLIC_` 接頭辞を付与し、機密値は付与しない。
- `NEXT_PUBLIC_` を付与する設定は公開影響レビューを必須とし、目的・参照箇所・除去条件を記録する。
- 機密情報（APIキー、トークン、接続情報）はサーバー側境界でのみ参照し、配信成果物へ含めない。

### 出力エスケープと防御設定
- 3rd party script の導入は `<Script>` を利用し、読み込み戦略と必要性を明示する。
- CSP（Content Security Policy）を配信境界に適用し、許可オリジンを最小化する。
- 監査ログは `correlation_id` / `trace_id` を含む構造化ログで記録し、セキュリティイベントの追跡を可能にする。

### 外部サービスの評価と代替導線（[[RQ-UX-022]]）
- 新規に導入するサードパーティ/クラウドサービスは、導入前にアクセシビリティ適合状況（VPAT等）の確認記録を残す。
- 重大なアクセシビリティ欠陥が判明した場合は、機能停止/制限の判定基準を定義し、代替導線（管理画面導線または同等情報の別画面）を提供する。
- 影響範囲が公開UIに及ぶ場合は、利用制限と回避策を運用告知へ反映し、復旧期限の暫定目標を設定する。
- 定期再評価は重大変更時または年1回の早い方で実施し、結果を運用証跡へ記録する。

### 本番前チェック観点
- `next build` + `next start` で本番相当検証を実施し、環境差分由来の設定漏れを排除する。
- 機密データがクライアントへ漏れていないことを、主要導線のレスポンス/画面出力で確認する。
- 認可失敗、入力不正、依存脆弱性、秘密情報漏えいの4観点をリリース前判定に含める。

## 変更履歴
- 2026-02-11: [[RQ-UX-022]] 対応として外部サービス評価（VPAT等）と代替導線・再評価運用を追加 [[BD-ADR-024]]
- 2026-02-11: Next.js App Router前提のセキュリティ統制（Server Actions認可、秘密情報境界、CSP、env運用）を追加 [[BD-ADR-024]]
- 2026-02-10: 新規作成 [[BD-ADR-001]]
