---
id: BD-APP-UI-003
title: 画面遷移
doc_type: UI設計
phase: BD
version: 1.0.5
status: 下書き
owner: RQ-SH-001
created: 2026-01-31
updated: '2026-02-14'
up:
- '[[RQ-SC-001]]'
- '[[RQ-FR-001]]'
related:
- '[[BD-SYS-ARCH-001]]'
- '[[BD-SYS-ADR-001]]'
- '[[BD-SYS-ADR-021]]'
- '[[BD-SYS-ADR-009]]'
- '[[BD-SYS-ADR-010]]'
- '[[BD-APP-API-002]]'
- '[[RQ-UC-001]]'
- '[[RQ-UC-002]]'
- '[[RQ-UC-006]]'
- '[[RQ-UC-007]]'
- '[[RQ-UC-008]]'
- '[[RQ-UC-009]]'
tags:
- diopside
- BD
- UI
---


## 設計方針
- 画面遷移は「[[RQ-SH-002|利用者]]の探索導線」と「[[RQ-SH-001|管理者]]の運用導線」を分離して定義し、役割混在による迷いを防ぐ。
- 通常遷移だけでなく、取得失敗・競合・未生成時の復帰遷移を同じ図上で扱い、運用時の判断を画面設計に埋め込む。
- 一覧コンテキスト（[[RQ-GL-014|検索条件]]・スクロール位置）は[[DD-APP-UI-004|詳細モーダル]]往復で保持し、探索の連続性を維持する。

## 設計要点
- [[RQ-SH-002|利用者]]導線は「一覧を軸に詳細へ一時遷移して戻る」構造とし、外部遷移失敗時も一覧復帰可能とする。
- [[RQ-SH-001|管理者]]導線は run 単位の状態遷移（起動/監視/失敗調査/[[RQ-GL-011|再収集]]/確定）を前提に、各画面を順方向・逆方向どちらでも辿れるようにする。
- [[RQ-SH-001|管理者]]導線は run 状態と[[RQ-GL-018|配信反映実行]]状態を分離し、配信反映失敗時に旧公開版へ復帰できる導線を持つ。
- [[RQ-GL-016|コメント密度波形]]と[[RQ-GL-017|ワードクラウド]]は[[DD-APP-UI-004|詳細モーダル]]内の補助遷移として扱い、主遷移（開く/閉じる/外部遷移）を優先する。

## 画面遷移図
```mermaid
flowchart TD
  subgraph U[利用者導線]
    U01[一覧画面 UI-U01 DD-APP-UI-002]
    U02[検索・絞り込み UI-U02 DD-APP-UI-003]
    U03[詳細モーダル UI-U03 DD-APP-UI-004]
    UY[YouTube視聴ページ]
    UE1[詳細取得失敗表示]
    UE2[補助情報未生成表示]
  end

  subgraph A[管理者導線]
    A01[収集実行 UI-A01 DD-APP-UI-007]
    A02[実行監視・履歴 UI-A02 DD-APP-UI-006]
    A03[再収集設定 UI-A03 DD-APP-UI-008]
    A04[配信前後確認・手動タグ UI-A04 DD-APP-UI-009]
    A06[配信反映ジョブ UI-A06 DD-APP-UI-010]
    A05[公開運用・配信経路確認 UI-A05 DD-APP-UI-011]
    AE1[入力エラー/競合表示]
    AE2[失敗調査結果表示]
    AE3[配信反映失敗表示]
  end

  U01 --> U02
  U02 --> U01
  U01 -->|カード選択| U03
  U03 -->|閉じる| U01
  U03 -->|YouTubeで開く| UY
  U03 -->|区間クリック t=<秒>| UY
  U03 -->|詳細取得失敗| UE1
  UE1 -->|再試行| U03
  U03 -->|波形/ワードクラウド未生成| UE2
  UE2 -->|主操作継続| U03

  A01 -->|実行確定| A02
  A01 -->|入力不備/競合| AE1
  AE1 -->|修正して再実行| A01
  A02 -->|失敗run選択| AE2
  AE2 -->|再収集へ| A03
  A03 -->|再実行受付| A02
  A02 -->|配信前後確認へ| A04
  A04 -->|反映実行へ| A06
  A06 -->|反映成功| A05
  A06 -->|反映失敗| AE3
  AE3 -->|再試行| A06
  AE3 -->|ロールバック確認| A04
  A05 -->|異常検知| A02
```

## 遷移定義
- [[DD-APP-UI-002|UI-U01]] -> [[DD-APP-UI-004|UI-U03]]: カード選択で遷移し、戻り時は [[RQ-GL-014|検索条件]] とスクロール位置を復元する（[[RQ-UC-006]]）。
- `詳細モーダル -> YouTube`: 通常遷移と `t=<秒>` 遷移の2系統を持ち、失敗時はURLコピー導線を表示してモーダル継続利用を可能にする（[[RQ-FR-014]], [[RQ-FR-020]]）。
- [[DD-APP-UI-007|UI-A01]] -> [[DD-APP-UI-006|UI-A02]]: run ID 発行後に `queued`/`running` を監視し、完了時に `succeeded`/`failed` を確定表示する（[[RQ-FR-001]], [[RQ-UC-001]]）。
- [[DD-APP-UI-006|UI-A02]] -> [[DD-APP-UI-008|UI-A03]]: 失敗原因分類後、対象runを引き継いで [[RQ-GL-011|再収集]] を起動する（[[RQ-UC-007]], [[RQ-UC-008]]）。
- [[DD-APP-UI-009|UI-A04]] -> [[DD-APP-UI-010|UI-A06]]: 差分確認と手動タグ付け確定後、[[RQ-GL-018|配信反映実行]]を起動して静的成果物を再生成する（[[RQ-FR-005]], [[RQ-FR-019]]）。
- [[DD-APP-UI-010|UI-A06]] -> [[DD-APP-UI-011|UI-A05]]: 反映成功後に公開作業へ進み、経路異常時は監視画面へ戻す（[[RQ-UC-009]], [[RQ-FR-024]], [[RQ-FR-025]]）。

## 例外時の復帰方針
- [[RQ-SH-002|利用者]]導線の例外は、原則として「一覧を失わずに再試行可能」とし、モーダル起点で復帰させる。
- [[RQ-SH-001|管理者]]導線の例外は、原則として「run単位で追跡可能」を維持し、失敗時も履歴画面をハブにする。
- 配信反映失敗時は旧公開版維持を前提に、配信前後確認画面へ戻って再試行判断できるようにする。
- 補助表示の失敗（[[RQ-GL-016|コメント密度波形]]/[[RQ-GL-017|ワードクラウド]]）は主操作を無効化しない。

## 変更履歴
- 2026-02-14: 遷移ノードと遷移定義に各画面DD-UIリンク（`DD-APP-UI-002`〜`DD-APP-UI-011`）を追加 [[BD-SYS-ADR-021]]
- 2026-02-11: 配信反映ジョブ導線（UI-A06）と[[RQ-GL-018|配信反映実行]]失敗復帰を追加 [[BD-SYS-ADR-021]]
- 2026-02-11: `publish run` 表記を [[RQ-GL-018|配信反映実行]] に統一 [[BD-SYS-ADR-021]]
- 2026-02-10: 新規作成 [[BD-SYS-ADR-001]]
- 2026-02-11: 画面遷移を[[RQ-SH-002|利用者]]/[[RQ-SH-001|管理者]]導線と例外復帰を含む遷移定義へ再構成 [[BD-SYS-ADR-010]]
