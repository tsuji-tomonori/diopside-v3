---
id: BD-MON-001
title: 監視設計
doc_type: 監視設計
phase: BD
version: 1.0.2
status: 下書き
owner: RQ-SH-001
created: 2026-01-31
updated: '2026-02-11'
up:
- '[[RQ-SC-001]]'
- '[[RQ-OBY-001]]'
related:
- '[[BD-ARCH-001]]'
- '[[BD-ADR-006]]'
- '[[DD-LOG-001]]'
- '[[DD-AV-001]]'
- '[[DD-PERF-001]]'
- '[[AT-OPS-001]]'
tags:
- diopside
- BD
- MON
---


## 目的
- [[RQ-OBY-001]] の受入基準を、運用で実測・判定できる監視基盤へ落とし込む。
- 監視結果を [[RQ-GL-011|再収集]]、障害切り分け、Go/No-Go判定へ接続する。

## 監視対象と観測点
| 対象 | 観測点 | 主指標 | 粒度 | 保持方針 |
| --- | --- | --- | --- | --- |
| 収集実行 | 収集runイベント | `run_id`、開始/終了時刻、対象/成功/失敗件数 | run単位 | 0-30日即時検索、31-90日低コスト保管 |
| 検索API | API応答ログ | ステータスコード、応答時間、[[RQ-GL-014|検索条件]]種別 | リクエスト単位 | 0-30日即時検索、31-90日低コスト保管 |
| 配信経路 | CDN/配信エラーログ | 配信エラー率、最新更新時刻、`5xx`率 | 1分集計 | 90日保持 |
| 運用操作 | 管理画面操作ログ | 実行者、操作種別、対象run、結果 | 操作単位 | 90日保持 |

## SLI定義（監視設計）
| SLI ID | 指標定義 | 算出単位 | 観測窓 | 閾値参照 |
| --- | --- | --- | --- | --- |
| SLI-ING-SUCCESS | 収集成功率 = 成功件数 / 対象件数 | run | 24時間/30日 | [[RQ-OBY-001]] |
| SLI-API-LATENCY | API応答時間p95 | リクエスト | 1時間/24時間 | [[RQ-PS-001]] |
| SLI-AVAILABILITY | 可用率 = 正常応答時間 / 監視対象時間 | 1分 | 月次 | [[RQ-AV-001]] |
| SLI-DELIVERY-ERROR | 配信エラー率 = `5xx`件数 / 全配信件数 | 1分 | 1時間/24時間 | [[RQ-OBY-001]] |
| SLI-LOG-COVERAGE | ログ記録率 = 必須項目を満たすログ件数 / 全対象件数 | リクエスト/run | 1時間/24時間 | [[RQ-OBY-001]] |

## 欠測と品質低下の扱い
- ログ欠測率が 1% を超えた場合は運用障害として扱い、欠測区間と影響SLIを記録する。
- 監視基盤停止時は復旧後に欠測時間帯を [[AT-RPT-001]] へ明記し、Go判定では例外承認なしに合格扱いしない。
- 閾値超過が連続3回発生した場合は暫定対処を実施し、次リリースまでに恒久対処を反映する。

## 監視と運用導線
- 監視アラートは「通知 -> 原因切り分け -> [[RQ-GL-011|再収集]]判定」の順で処理する。
- 収集失敗は run単位で[[RQ-GL-011|再収集]]対象を抽出し、[[RQ-UC-008]] の操作導線へ渡す。
- 監視証跡は [[AT-OPS-001]] でチェックし、結果を [[AT-RPT-001]] と [[AT-GO-001]] に転記する。

## 変更履歴
- 2026-02-11: 監視対象/SLI/欠測時扱い/受入連携を具体化し、監視設計を全面改訂 [[BD-ADR-006]]
- 2026-02-10: 新規作成 [[BD-ADR-006]]
