---
id: BD-API-001
title: API一覧
doc_type: API設計
phase: BD
version: 1.0.3
status: 下書き
owner: RQ-SH-001
created: 2026-01-31
updated: '2026-02-11'
up:
- '[[RQ-SC-001]]'
- '[[RQ-FR-001]]'
related:
- '[[BD-ARCH-001]]'
- '[[BD-ADR-001]]'
- '[[BD-ADR-009]]'
- '[[BD-ADR-010]]'
- '[[RQ-FR-020]]'
- '[[RQ-FR-022]]'
- '[[RQ-FR-021]]'
tags:
- diopside
- BD
- API
---


## 設計方針
- 本システムは静的配信を基本とし、Web表示に必要な契約を「静的JSON契約」と「静的アセット契約」に分けて管理する。
- `[[RQ-FR-020]]` に対応する見どころ導線は、[[RQ-GL-016|コメント密度波形]]の静的JSON配信で提供する。
- `[[RQ-FR-021]]` に対応する[[RQ-GL-017|ワードクラウド]]は、動的生成APIではなく事前生成済み画像の静的配信で提供する。

## 設計要点
- 一覧・検索用データは `bootstrap.json` / `tag_master.json` / `archive_index.pN.json` を継続利用する。
- 動画詳細の補助表示データ（[[RQ-GL-016|コメント密度波形]]）は `highlights/{videoId}.json` 契約で配信する。
- 動画詳細の補助表示データ（[[RQ-GL-017|ワードクラウド]]）は `wordcloud/{videoId}.png` 契約で配信する。
- クライアントは静的アセット取得失敗時に代替表示へフォールバックし、詳細モーダルを継続表示する。

## 契約一覧
| 種別 | パス/契約 | 用途 | 主な利用要求 |
|---|---|---|---|
| 静的JSON | `bootstrap.json` | 初期表示データ | `[[RQ-FR-015]]` |
| 静的JSON | `tag_master.json` | [[RQ-GL-005|タグ辞書]] | `[[RQ-FR-005]]` |
| 静的JSON | `archive_index.p{page}.json` | [[RQ-GL-010|段階ロード]]一覧 | `[[RQ-FR-007]]`, `[[RQ-FR-015]]` |
| 静的JSON | `highlights/{videoId}.json` | 動画詳細の[[RQ-GL-016|コメント密度波形]]と[[RQ-GL-015|盛り上がり区間]]表示 | `[[RQ-FR-020]]`, `[[RQ-FR-022]]` |
| 静的画像 | `wordcloud/{videoId}.png` | 動画詳細の話題傾向表示 | `[[RQ-FR-021]]` |

## [[RQ-GL-016|コメント密度波形]]静的配信契約
- **命名規約**: `highlights/{videoId}.json`（`videoId` はYouTube動画ID、拡張子は `json` 固定）。
- **データ内容**: 動画ID、生成時刻、波形系列（経過秒/密度値）、[[RQ-GL-015|盛り上がり区間]]（開始秒/終了秒/密度指標/コメント件数）を保持する。
- **生成タイミング**: 収集後バッチで `[[RQ-FR-022]]` の生成処理を実行し、Web配信領域へ配置する。
- **HTTPステータス運用**:
  - `200`: 波形表示と区間クリック遷移を有効化。
  - `404`: 未生成扱いとして「[[RQ-GL-015|盛り上がり区間]]なし」を表示。
  - `5xx`/ネットワーク失敗: 再試行導線付きの取得失敗表示。
- **フォールバック方針**: 波形データ不正・破損時は波形描画を中断し、モーダル機能（タグ、遷移、閉じる）を維持する。

## [[RQ-GL-017|ワードクラウド]]静的配信契約
- **命名規約**: `wordcloud/{videoId}.png`（`videoId` はYouTube動画IDそのまま、拡張子は `png` 固定）。
- **生成タイミング**: 収集/前処理バッチ後に事前生成し、Web配信領域へ配置する。
- **取得方式**: クライアントは詳細モーダル表示時に動画IDからURLを組み立てて取得する。
- **HTTPステータス運用**:
  - `200`: 画像表示。
  - `404`: 未生成扱いとして「[[RQ-GL-017|ワードクラウド]]なし」を表示。
  - `5xx`/ネットワーク失敗: 再試行導線付きの取得失敗表示。
- **キャッシュ方針**: 画像は `Cache-Control` を付与して配信し、更新はファイル差し替えで反映する。
- **フォールバック方針**: 画像不正・破損時は表示を中断し、モーダル機能（タグ、遷移、閉じる）を維持する。

## 変更履歴
- 2026-02-10: 新規作成
- 2026-02-11: `[[RQ-FR-021]]` 対応として[[RQ-GL-017|ワードクラウド]]静的配信契約（`wordcloud/{videoId}.png`）を追加
- 2026-02-11: `[[RQ-FR-020]]` 意味変更に合わせ、[[RQ-GL-016|コメント密度波形]]の静的配信契約（`highlights/{videoId}.json`）を追加
