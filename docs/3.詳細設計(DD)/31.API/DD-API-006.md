---
id: DD-API-006
title: 検索API
doc_type: API詳細
phase: DD
version: 1.0.3
status: 下書き
owner: RQ-SH-001
created: 2026-01-31
updated: '2026-02-10'
up:
- '[[BD-ARCH-001]]'
- '[[BD-API-001]]'
related:
- '[[RQ-FR-001]]'
- '[[UT-PLAN-001]]'
tags:
- diopside
- DD
- API
---

## 目的
- 利用者検索を高速化するため、MVPではクライアント内検索契約を定義する。

## MVP適用境界
- 本項目は将来サーバ検索APIの予約設計であり、MVPではクライアント検索を正本とする。
- サーバ検索APIの実装着手時に、別RDR/ADRで採用判断を追加する。

## 検索契約（クライアント実行）
- 入力
  - `q`: 空白分割トークン（AND）
  - `selectedTags`: タグ集合
  - `tagMode`: `AND | OR`
  - `dateRange`: `fromYmd`, `toYmd`
  - `durationRange`: 最小/最大分
  - `sortOrder`: `asc | desc`
- 出力
  - 条件適合動画のソート済み配列

## 判定ロジック
- キーワードは前計算`searchText`に対する部分一致。
- タグは`tagMode`に応じて全包含または任意一致。
- 日付はJST日付へ正規化して範囲比較。
- 再生時間は分→秒換算して閾値比較。

## 将来拡張
- サーバ検索導入時は `/api/v2/search` を追加し、同一パラメータ名を踏襲する。
- サーバ移行後もクライアント検索をフォールバックとして保持する。

## 受入観点
- `AT-SCN-002` で複合条件（キーワード+タグ+日付+時間）の再現が可能。
- 並び順切替時に順序が逆転すること。

## 変更履歴
- 2026-02-11: MVP非対象の予約境界を明記し、将来経路を `/api/v2/search` へ更新 [[BD-ADR-021]]
- 2026-02-10: 新規作成
- 2026-02-10: クライアント検索契約と判定ロジックを追加
