---
id: DD-INF-COG-001
title: Cognito詳細設計
doc_type: インフラ詳細
phase: DD
version: 1.0.0
status: 下書き
owner: RQ-SH-001
created: 2026-02-21
updated: '2026-02-21'
up:
- '[[BD-INF-PLAT-001]]'
- '[[BD-SYS-ADR-014]]'
related:
- '[[DD-INF-SEC-003]]'
- '[[DD-INF-CF-001]]'
- '[[DD-APP-API-010]]'
tags:
- diopside
- DD
- INF
---

## 詳細仕様
- Cognitoは `/openapi/*` と `/api/v1/*` の認証境界を固定し、匿名経路（`/web/*`, `/docs/*`）と分離する。
- JWT検証の鍵配布（JWKS）失敗時は認証失敗として扱い、保護経路をフェイルクローズで維持する。

## 認証境界
| 経路 | 認証 | 方針 |
|---|---|---|
| `/web/*` | 不要 | 匿名閲覧のみ |
| `/docs/*` | 不要 | 匿名閲覧のみ |
| `/openapi/*` | 必須 | 契約確認用途の保護経路 |
| `/api/v1/*` | 必須 | 管理操作/参照APIの保護経路 |

## 設定項目
| 項目 | 設計値 | 根拠 |
|---|---|---|
| User Pool | 1系統 | 管理対象を単純化し運用誤りを防ぐため。 |
| App Client | 保護経路専用 | 匿名経路との混在を防ぐため。 |
| Token検証 | API層で必須 | 認証境界の一貫性を担保するため。 |

## 監視
- 認証失敗率とJWKS取得失敗を監視し、急増時は認証基盤障害として切り分ける。
- 監視ログは [[DD-INF-MON-002]] のsecurityカテゴリへ記録する。

## 運用
- 認証境界の変更は配信経路設計（[[DD-INF-CF-001]]）と同一変更で実施する。
- 保護経路を匿名化する変更は破壊的変更として扱い、二重承認を必須化する。

## 変更履歴
- 2026-02-21: 新規作成（Cognito設定値と認証境界の正本を追加） [[BD-SYS-ADR-036]]
