---
id: DD-SEC-001
title: セキュリティ統制詳細
doc_type: セキュリティ詳細
phase: DD
version: 1.0.2
status: 下書き
owner: RQ-SH-001
created: 2026-01-31
updated: '2026-02-11'
up:
- '[[BD-ARCH-001]]'
- '[[BD-SEC-001]]'
related:
- '[[RQ-SEC-001]]'
- '[[RQ-PRC-001]]'
- '[[RQ-DEV-001]]'
- '[[DD-ERR-001]]'
- '[[DD-COST-001]]'
- '[[AT-OPS-001]]'
- '[[AT-RUN-001]]'
- '[[UT-PLAN-001]]'
tags:
- diopside
- DD
- SEC
---


## 詳細仕様
- 公開経路（`/docs/*`, `/web/*`）は匿名参照を許可し、運用経路（`/openapi/*`, `/api/v1/*`, `/ops/*`）は認証必須とする。
- 認可は「管理操作を実行できる主体」を最小化し、読取専用トークンで更新系操作を実行できない状態を維持する。
- 入力検証、依存ライブラリ脆弱性対策、秘密情報管理、タグ情報統制を同一統制面として運用する。

## 認証・認可境界
- 未認証アクセスは `401`、認証済みだが権限不足は `403` を返す。
- 管理操作（収集起動、再実行、タグ更新、公開反映）は `operator` ロールのみ許可し、閲覧専用ロールでは拒否する。
- トークン失効後の再利用はすべて拒否し、拒否結果を監査ログへ記録する。

## 入力検証
- API入力は `required`、型、最大長、列挙値、日時形式（ISO8601）をサーバ側で検証する。
- 不正入力は業務処理前に `400` で中断し、エラーコードは [[DD-ERR-001]] で定義した分類を使用する。
- タグ更新入力は `aws:` プレフィックス禁止、PII/秘密情報禁止、`UpperCamelCase` キー固定を検証する。

## 依存ライブラリと秘密情報
- リリース候補ごとに脆弱性スキャンを実行し、Critical/High を 0 件にするまで反映禁止とする。
- 秘密情報は環境変数またはシークレットストア参照のみ許可し、リポジトリへの平文配置を禁止する。
- CIログや運用ログへ秘密情報を出力しないよう、マスク対象を明示して適用する。

## 監査ログ要件
- 管理操作は `operator`, `action`, `resource`, `result`, `traceId`, `occurredAt` を必須記録する。
- 認可拒否と入力検証失敗は成功操作と同じ粒度で記録し、追跡漏れを防止する。
- 監査ログは 90 日保持し、直近 30 日は即時検索できる状態を維持する。

## 障害時ハンドリング
- 認可経路の失敗率が 1% を超えた場合は認証基盤障害として [[AT-RUN-001]] の手順へ移行する。
- 禁止タグ混入を検知した場合は当日中に削除し、是正履歴を [[AT-OPS-001]] に記録する。
- 脆弱性スキャンで Critical 検出時はリリース停止し、24 時間以内に暫定対処またはロールバックする。

## I/Oまたは責務
- 入力: APIリクエスト、管理操作イベント、認証トークン、依存ライブラリ検査結果、タグ更新要求。
- 出力: 認可判定結果、検証済み入力、監査ログ、セキュリティエラー応答、運用是正記録。

## 変更履歴
- 2026-02-11: 認証/認可境界、入力検証、秘密情報管理、監査ログ、障害時ハンドリングを具体化
- 2026-02-10: 新規作成
