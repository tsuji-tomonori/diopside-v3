---
id: RQ-AV-004
title: バッチ収集のタイムアウト・リトライ・サーキットブレーカー
doc_type: 非機能要求
phase: RQ
version: 1.0.0
status: 下書き
owner: RQ-SH-001
created: 2026-02-16
updated: '2026-02-16'
up:
- '[[RQ-SC-001]]'
related:
- '[[RQ-AV-001]]'
- '[[RQ-DATA-002]]'
- '[[RQ-PS-002]]'
tags:
- diopside
- RQ
- AV
---


## SnowCard（日本語）
- 要求ID: RQ-AV-004
- 種別: 非機能要求
- 優先度: SHOULD
- 要求: 本システムの収集バッチは、YouTube API呼出に対してリトライ上限・指数バックオフ・サーキットブレーカーを適用し、障害の波及を防止すること。
- 根拠: 外部API障害時の無制限リトライはクォータ消費とLambda実行時間の浪費を招き、[[RQ-COST-001]] と [[RQ-PS-002]] に違反するため。
- 受入基準:
  - YouTube API呼出のリトライ上限が3回以内に設定されている。
  - リトライ間隔に指数バックオフ（初回1秒、最大30秒）が適用されている。
  - 連続5回の失敗でサーキットブレーカーがオープン状態に遷移する。
  - サーキットオープン時にアラートが発報され、[[RQ-OBY-001]] のログに記録される。
  - サーキットオープン後、次回スケジュール実行時にハーフオープンで再試行する。
- 例外/エラー:
  - YouTube API側のレートリミット（HTTP 429）はリトライ対象とし、`Retry-After` ヘッダーを尊重する。
  - サーキットオープンが24時間以上継続した場合は、手動確認のうえ収集スケジュールを一時停止する。
- 依存・関連:
  - [[RQ-AV-001]]
  - [[RQ-PS-002]]
  - [[RQ-DATA-002]]
  - [[RQ-OBY-001]]

## 変更履歴
- 2026-02-16: 新規作成
