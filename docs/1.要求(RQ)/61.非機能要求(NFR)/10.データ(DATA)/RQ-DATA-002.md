---
id: RQ-DATA-002
title: バッチ収集の冪等性
doc_type: 非機能要求
phase: RQ
version: 1.0.0
status: 下書き
owner: RQ-SH-001
created: 2026-02-16
updated: '2026-02-16'
up:
- '[[RQ-SC-001]]'
related:
- '[[RQ-DATA-001]]'
- '[[RQ-AV-004]]'
tags:
- diopside
- RQ
- DATA
---


## SnowCard（日本語）
- 要求ID: RQ-DATA-002
- 種別: 非機能要求
- 優先度: MUST
- 要求: 本システムの収集バッチは冪等に設計し、同一バッチの再実行でデータ重複を発生させないこと。
- 根拠: バッチ失敗からの再実行や手動リトライが安全に行える設計でなければ、[[RQ-DATA-001]] のデータ品質要件を維持できないため。
- 受入基準:
  - videoIdを自然冪等キーとして使用し、upsertセマンティクスで書き込む。
  - 同一収集バッチを連続2回実行した場合、2回目の実行でデータ件数の変動が0件である。
  - 部分失敗からの再実行時、成功済みアイテムの再処理がスキップまたはupsertで安全に処理される。
  - 冪等性の検証をcontract testまたは結合テストに含める。
- 例外/エラー:
  - YouTube API側でvideoIdが再採番された場合（極めて稀）は、手動確認のうえ重複排除を実施する。
  - 部分失敗時の再開ポイントが特定できない場合は、全件[[RQ-GL-011|再収集]]をupsertで安全に実行する。
- 依存・関連:
  - [[RQ-DATA-001]]
  - [[RQ-AV-004]]

## 変更履歴
- 2026-02-16: 新規作成
