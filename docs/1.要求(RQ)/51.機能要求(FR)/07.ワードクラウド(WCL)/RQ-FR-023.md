---
id: RQ-FR-023
title: ワードクラウド表示用画像を生成できる
doc_type: 機能要求
phase: RQ
version: 1.0.3
status: 下書き
owner: RQ-SH-001
created: 2026-02-11
updated: '2026-02-14'
up:
- '[[RQ-SC-001]]'
- '[[RQ-UC-001]]'
related:
- '[[RQ-RDR-022]]'
- '[[RQ-GL-017]]'
- '[[RQ-DM-009]]'
- '[[RQ-FR-004]]'
- '[[RQ-FR-021]]'
- '[[RQ-PRC-001-01]]'
- '[[RQ-PC-003]]'
- '[[BD-APP-API-001]]'
- '[[BD-APP-UI-002]]'
- '[[RQ-RDR-038]]'
bounded_context: Analytics
subdomain: Supporting
tags:
- diopside
- RQ
- FR
---

## SnowCard（日本語）
- 要求ID: RQ-FR-023
- 種別: 機能要求
- 優先度: MUST
- 要求: 本システムは、動画[[DD-APP-UI-004|詳細モーダル]]の[[RQ-GL-017|ワードクラウド]]表示に利用する画像を、公開チャット由来の集計結果から生成・保存できることを提供する。
- 根拠: 表示要求（[[RQ-FR-021]]）だけでは画像生成責務が曖昧になるため、データ整備要求として生成・保存条件を明示する必要があるため。
- 受入基準:
  - 動画IDごとに[[RQ-GL-017|ワードクラウド]]画像を生成し、詳細表示APIで参照できる状態で保存できる。
  - 生成処理は公開チャット由来の集計結果を入力とし、チャット本文そのものを保存しない。
  - 画像再生成時は同一動画IDの古い成果物を置換し、参照先を一意に保てる。
  - 入力は `meta_type=textMessageEvent` の `message_text` を抽出対象とし、公開チャット由来データのみを処理する。
  - 生成画像の出力キーは `wordcloud/{videoId}.png` を正本とし、再実行で同一キーを上書きする。
- 例外/エラー:
  - 生成に必要な集計入力が欠落する場合は未生成状態を記録し、詳細表示側へ代替表示判定を返す。
  - 画像生成失敗時は失敗理由と再試行対象を記録し、破損画像を公開しない。
- 依存・関連:
  - [[RQ-UC-001]]
  - [[RQ-GL-017]]
  - [[RQ-DM-009]]
  - [[RQ-FR-004]]
  - [[RQ-FR-021]]
  - [[RQ-PRC-001-01]]
  - [[RQ-PC-003]]
  - [[RQ-RDR-022]]

## テスト観点
- 正常系で動画IDに紐づく[[RQ-GL-017|ワードクラウド]]画像が生成・参照できること。
- 生成失敗時に破損画像を公開せず、未生成または失敗状態で扱われること。
- 再生成時に古い成果物が残留せず一意参照が維持されること。

## 個別確認チェックリスト
- 確認主体: [[RQ-SH-001|管理者]]
- 重点確認対象: 画像生成結果の一意参照と失敗時隔離
- 確認方法: 生成履歴と詳細表示API応答を照合し、参照先画像と状態遷移を確認する。

## 変更履歴
- 2026-02-13: [[RQ-GL-017|ワードクラウド]]生成の入力条件（`meta_type`/`message_text`）と出力キー正本（`wordcloud/{videoId}.png`）を追記 [[RQ-RDR-038]]
- 2026-02-11: 本文中の主体表現「[[RQ-SH-001|管理者]]/[[RQ-SH-002|利用者]]」をステークホルダーリンクへ統一 [[RQ-RDR-010]]
- 2026-02-11: 用語・モデル整合のため [[RQ-GL-017]] と [[RQ-DM-009]] を関連へ追加 [[RQ-RDR-022]]
- 2026-02-11: 新規作成 [[RQ-RDR-022]]
