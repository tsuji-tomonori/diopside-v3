---
id: RQ-FR-022
title: コメント密度波形表示用データを生成できる
doc_type: 機能要求
phase: RQ
version: 1.0.2
status: 下書き
owner: RQ-SH-001
created: 2026-02-11
updated: '2026-02-13'
up:
- '[[RQ-SC-001]]'
- '[[RQ-UC-001]]'
related:
- '[[RQ-RDR-022]]'
- '[[RQ-FR-004]]'
- '[[RQ-FR-020]]'
- '[[BD-SYS-ADR-010]]'
- '[[BD-APP-API-001]]'
- '[[BD-APP-UI-001]]'
- '[[BD-APP-UI-002]]'
- '[[RQ-RDR-038]]'
tags:
- diopside
- RQ
- FR
---

## SnowCard（日本語）
- 要求ID: RQ-FR-022
- 種別: 機能要求
- 優先度: MUST
- 要求: 本システムは、動画詳細モーダルの[[RQ-GL-016|コメント密度波形]]表示と[[RQ-GL-015|盛り上がり区間]]遷移に利用するデータを、収集済み公開データから生成・保存できることを提供する。
- 根拠: 表示要求（[[RQ-FR-020]]）だけでは密度算出・区間抽出の生成責務が曖昧になるため、データ整備要求として生成境界を明示する必要があるため。
- 受入基準:
  - 収集対象動画ごとに、時間軸上の密度値列と[[RQ-GL-015|盛り上がり区間]]（開始秒/終了秒/密度指標/コメント件数）を生成できる。
  - コメント密度は公開チャット由来のメッセージ時刻分布から算出し、密度が高い区間を[[RQ-GL-015|盛り上がり区間]]として抽出できる。
  - 生成済みデータは動画IDに紐づき、詳細表示で波形レンダリングと区間クリック遷移に再利用できる。
  - 再生成時に同一動画IDの重複行を作らず、最新生成結果へ置換できる。
  - 入力は `meta_type` と `message_text` を必須列にもつ公開チャット由来CSVを受け付ける。
  - 生成処理の検出パターンは `草|w|くさ|kusa` を初期値とし、運用設定で上書き可能にする。
- 例外/エラー:
  - 時刻解析に失敗した入力は対象行を隔離し、生成失敗理由を記録する。
  - 生成途中で失敗した場合は不完全データを公開せず、前回確定版を保持する。
- 依存・関連:
  - [[RQ-UC-001]]
  - [[RQ-GL-015]]
  - [[RQ-GL-016]]
  - [[RQ-FR-004]]
  - [[RQ-FR-020]]
  - [[RQ-RDR-022]]

## テスト観点
- 同一動画で密度波形データと[[RQ-GL-015|盛り上がり区間]]が一貫して生成されること。
- 失敗行隔離時でも成功行データが欠落せず保存されること。
- 再生成時に重複行が増えず最新結果へ置換されること。

## 個別確認チェックリスト
- 確認主体: [[RQ-SH-001|管理者]]
- 重点確認対象: 密度算出・[[RQ-GL-015|盛り上がり区間]]抽出の生成整合
- 確認方法: 生成ログと詳細表示応答を照合し、区間開始秒/終了秒と密度指標の整合を確認する。

## 変更履歴
- 2026-02-13: 生成入力必須列とコメント密度検出パターン（`草|w|くさ|kusa`）を受入基準へ追加 [[RQ-RDR-038]]
- 2026-02-11: 本文中の主体表現「管理者/利用者」をステークホルダーリンクへ統一 [[RQ-RDR-010]]
- 2026-02-11: [[RQ-FR-020]] の意味変更に合わせ、時刻表示データ生成要求から[[RQ-GL-016|コメント密度波形]]データ生成要求へ更新 [[RQ-RDR-022]]
- 2026-02-11: 新規作成 [[RQ-RDR-022]]
