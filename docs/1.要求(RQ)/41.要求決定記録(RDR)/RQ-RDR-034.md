---
id: RQ-RDR-034
title: DB正本管理を前提に3層構造で段階拡張する決定
doc_type: 要求決定記録
phase: RQ
version: 1.0.2
status: 下書き
owner: RQ-SH-001
created: 2026-02-11
updated: '2026-02-14'
up:
- '[[RQ-SC-001]]'
related:
- '[[RQ-RDR-003]]'
- '[[RQ-DATA-001]]'
- '[[RQ-INT-001]]'
- '[[RQ-FR-005]]'
- '[[RQ-FR-025]]'
- '[[BD-SYS-ADR-021]]'
- '[[BD-SYS-ARCH-001]]'
- '[[BD-APP-DATA-001]]'
- '[[BD-APP-API-001]]'
tags:
- diopside
- RQ
- RDR
---

## 決定事項
- 原本データ（タグ、[[RQ-GL-014|検索条件]]に利用するメタデータ）はDBを正本として管理する。
- 利用者向け検索は当面 [[RQ-GL-007|bootstrap]] / [[RQ-GL-008|タグマスター]] / [[RQ-GL-009|アーカイブ索引]] の静的配信を継続する。
- 高度あいまい検索はMVP対象外とし、将来 `API検索エンドポイント` を追加できる拡張境界を確保する。
- システム構造は「プレゼンテーション層（管理画面/利用者画面/文書）」「アプリケーション層（Backend API）」「データ層（DB/S3）」の3層で管理する。
- バッチ処理（収集/再確認/公開反映）は単一のBackend API（Hono）内で実行し、別デプロイのworkerサービスを持たない。
- 定期実行は外部スケジューラが同一Backend APIの運用エンドポイントを呼び出して開始する。

## 理由
- DB正本化により、将来の検索方式拡張時も更新系と参照系の責務境界を維持できる。
- 利用者検索を静的配信で継続することで、MVP時点の表示性能と運用安定性を優先できる。
- 3層境界を要求段階で固定すると、設計文書間の追跡と[[AT-GO-001|リリース判定]]の整合を維持しやすい。

## 影響
- 旧決定 [[RQ-RDR-003]] は廃止し、本決定へ統合する。
- 設計決定として [[BD-SYS-ADR-021]] を追加し、3層境界と段階導入方針を固定する。
- 基本設計は [[BD-SYS-ARCH-001]] / [[BD-APP-DATA-001]] / [[BD-APP-API-001]] / [[BD-APP-API-002]] / [[BD-INF-DEP-004]] を更新する。
- 詳細設計は [[DD-APP-API-001]] / [[DD-APP-API-002]] / [[DD-APP-API-012]] / [[DD-APP-API-014]] で静的配信契約と管理API契約の境界、および単一API内実行方式を追従させる。

## 変更履歴
- 2026-02-14: 決定記録から具体ファイル名を除外し、用語リンク中心の記述へ統一 [[RQ-RDR-042]]
- 2026-02-11: バッチ実行方式を「単一Backend API（Hono）内実行 + 外部スケジューラ起動」に明確化 [[RQ-RDR-034]]
- 2026-02-11: 新規作成 [[RQ-RDR-034]]
