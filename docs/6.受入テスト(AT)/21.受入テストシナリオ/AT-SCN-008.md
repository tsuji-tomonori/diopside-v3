---
id: AT-SCN-008
title: メタデータ正規化・性能シナリオ
doc_type: 受入テストシナリオ
phase: AT
version: 1.0.0
status: 下書き
owner: RQ-SH-001
created: 2026-02-12
updated: '2026-02-12'
up:
- '[[BD-DEV-TEST-001]]'
- '[[IT-PLAN-001]]'
related:
- '[[AT-GO-001]]'
- '[[RQ-FR-002]]'
- '[[RQ-FR-003]]'
- '[[RQ-FR-004]]'
- '[[RQ-PS-001]]'
- '[[DD-APP-API-002]]'
tags:
- diopside
- AT
- SCN
---


## シナリオ目的
- メタデータ正規化（チャンネルID判定、出演補完、欠損フラグ付与）が正しく動作することを確認する。
- 非機能要求（性能）の受入閾値を満たすことを確認する。

## 対応要求
- [[RQ-FR-002]]: 公式投稿のチャンネルID一致判定
- [[RQ-FR-003]]: 出演補完取り込み
- [[RQ-FR-004]]: メタデータ正規化

## 対応DD-API
- [[DD-APP-API-002]]（[[RQ-GL-002|収集ジョブ]]起動API）
- [[DD-APP-API-011]]（収集結果明細API）

## 前提条件
- 受入環境で[[RQ-GL-002|収集ジョブ]]が実行可能。
- 異常なメタデータを含むサンプル動画がYouTube上に存在する（またはモックデータで代替）。

## 手順（メタデータ正規化）
1. 公式チャンネル以外のチャンネルIDを持つ動画を含む収集を実行する。
2. `GET /api/v1/ops/ingestion/runs/{runId}/items` で処理明細を取得する。
3. 公式チャンネル外の動画が `sourceType=appearance` として分類されていることを確認する。
4. 日時形式が不正な動画（例: タイムゾーン欠落）の処理結果を確認する。
5. 欠損フラグ（`missingFields`）が適切に付与されていることを確認する。
6. [[RQ-GL-004|出演動画]]の補完取り込み（外部リスト参照）が正しく動作することを確認する。

## 期待結果（メタデータ正規化）
- `official` と `appearance` が正しく分類される。
- 日時は ISO8601 形式に正規化される。
- 欠損フィールドには `missingFields[]` が付与される。
- 正規化失敗時は `status=failed` と `failureReasonCode` が記録される。

## 手順（性能検証）
1. Webトップページの初期表示時間（LCP）を計測する。
2. 検索実行から結果表示までの時間を計測する。
3. [[RQ-GL-010|段階ロード]]の追加読み込み時間を計測する。
4. 並び替え操作の応答時間を計測する。

## 期待結果（性能検証）
| 指標 | 閾値（p95） | 計測方法 |
|------|------------|---------|
| LCP | 2.5秒以下 | Chrome DevTools / Lighthouse |
| 検索応答 | 1.5秒以下 | Performance API |
| [[RQ-GL-010|段階ロード]] | 2.0秒以下 | Performance API |
| 並び替え | 1.0秒以下 | Performance API |

## 計測条件
- ネットワーク: 4G相当（RTT 150ms, 下り1.6Mbps）
- 端末: ミドルレンジ相当（CPU 4x slowdown）
- ブラウザキャッシュ: 初回訪問（キャッシュなし）

## 判定基準対応
- 機能判定: メタデータ正規化がMust FR要件を満たす。
- 非機能判定: 性能p95が[[RQ-PS-001]]の閾値を達成。

## 記録項目
- 実行日時
- 実行者
- 使用データ版
- 計測ツール（Lighthouse バージョン等）
- 各指標の計測値（p50, p95）
- 判定（Pass/Fail）

## 変更履歴
- 2026-02-12: 新規作成（分析レポートに基づく追加）
