---
id: AT-SCN-009
title: タグ管理運用シナリオ
doc_type: 受入テストシナリオ
phase: AT
version: 1.0.0
status: 下書き
owner: RQ-SH-001
created: 2026-02-12
updated: '2026-02-12'
up:
- '[[BD-TST-001]]'
- '[[IT-PLAN-001]]'
related:
- '[[AT-GO-001]]'
- '[[RQ-FR-005]]'
- '[[RQ-FR-009]]'
- '[[DD-API-013]]'
tags:
- diopside
- AT
- SCN
---


## シナリオ目的
- [[RQ-GL-005|タグ辞書]]の新規作成、更新、廃止、統合が正しく動作することを確認する。
- 管理画面から動画への手動タグ付けが正しく動作することを確認する。

## 対応要求
- [[RQ-FR-005]]: タグ管理機能
- [[RQ-FR-009]]: タグの廃止・統合

## 対応DD-API
- [[DD-API-013]]（タグ管理API）
- [[DD-API-015]]（配信反映ジョブ状態API）

## 前提条件
- 受入環境で管理画面が起動している。
- 既存の[[RQ-GL-005|タグ辞書]]と動画データが存在する。

## 手順（タグ新規作成）
1. 管理画面からタグ管理画面（UI-A03）を開く。
2. 新規タグ作成フォームで `tag_name`, `tag_type_id`, `synonyms[]` を入力する。
3. 作成ボタンを押下する。
4. タグ一覧に新規タグが表示されることを確認する。
5. `tag_master.json` に新規タグが含まれることを確認する（配信反映後）。

## 期待結果（タグ新規作成）
- 新規タグがDB正本に保存される。
- 配信反映後、`tag_master.json` に反映される。
- 監査ログに作成操作が記録される。

## 手順（タグ更新）
1. 既存タグの編集画面を開く。
2. `tag_name` または `synonyms[]` を変更する。
3. 保存ボタンを押下する。
4. 変更が反映されていることを確認する。

## 期待結果（タグ更新）
- タグ情報が更新される。
- `propagation_state=pending_publish` が設定される。
- 配信反映後、`tag_master.json` に反映される。

## 手順（タグ廃止）
1. 廃止対象タグの編集画面を開く。
2. `is_active=false` に設定する。
3. 保存ボタンを押下する。
4. タグ一覧で廃止済みタグが識別可能な表示になることを確認する。
5. 新規タグ付与時に廃止済みタグが選択肢から除外されることを確認する。
6. 既存の動画タグ付けは維持されることを確認する。

## 期待結果（タグ廃止）
- 廃止済みタグは `is_active=false` で保存される。
- 新規付与対象から除外される。
- 既存の動画タグ関連は維持される。
- 配信データでは廃止フラグ付きで表示される。

## 手順（タグ統合）
1. 統合元タグの編集画面を開く。
2. `merged_into` に統合先タグIDを設定する。
3. 保存ボタンを押下する。
4. 統合元タグを使用していた動画が統合先タグに移行されることを確認する。
5. 統合元タグが検索で使用された場合、統合先タグの結果が表示されることを確認する。

## 期待結果（タグ統合）
- 統合元タグが `merged_into` 設定される。
- 動画タグ関連が統合先に移行される。
- 検索時にシノニム解決が行われる。

## 手順（手動タグ付け）
1. 動画詳細画面または配信前後確認画面（UI-A05）を開く。
2. タグ付与フォームで付与/解除するタグを選択する。
3. 操作理由を入力する。
4. 保存ボタンを押下する。
5. 動画のタグ情報が更新されることを確認する。

## 期待結果（手動タグ付け）
- 動画タグが更新される。
- 操作理由が監査ログに記録される。
- 配信反映後、`archive_index` 内のタグ情報が更新される。

## 判定基準対応
- 機能判定: タグ管理のMust FR要件を満たす。
- データ判定: タグ不整合（重複、孤立参照）が0件。

## 記録項目
- 実行日時
- 実行者
- 操作対象タグ/動画
- 操作種別（作成/更新/廃止/統合/手動付与）
- 判定（Pass/Fail）

## 変更履歴
- 2026-02-12: 新規作成（分析レポートに基づく追加）
