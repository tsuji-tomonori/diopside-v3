# diopside-v3 ドキュメント品質分析レポート

**分析日**: 2026-02-13
**対象ファイル数**: 330 MD files (6 phases)
**分析者**: Claude Code Analysis
**バージョン**: 2.0

---

## エグゼクティブサマリー

### 総合評価ダッシュボード（フェーズ別スコアカード）

| 観点 | v1.0 (02-12) | v2.0 (02-13) | 状態 | 主な変化 |
|------|:---:|:---:|:---:|------|
| 要求定義 (RQ) | 72% | **85%** | 改善 | 曖昧性解消済、新規矛盾4件追加検出 |
| 基本設計 (BD) | 76% | **88%** | 改善 | BAT-006/007追加、ADR整合課題残存 |
| 詳細設計 (DD) | 60% | **82%** | 改善 | DD-ARCH-002追加、DDLカラム課題残存 |
| テスト設計 (UT/IT/AT) | 44% | **75%** | 改善 | 15ケース追加、RTM構造的乖離を新規検出 |
| 運用設計 | 65% | **88%** | 改善 | バックアップ/障害判定補完、CORS等3件追加 |
| 規約・標準 | 80% | **78%** | 微減 | DD-ARCH-002追加も、全文書下書き問題を新規検出 |

**総合評価**: **条件付きリリース可能 (Conditionally Release Ready)**

v1.0で「リリース可能」と評価したが、v2.0の深掘り分析で54件の未解決Findingを新たに特定。Critical未解決は0件だがHigh未解決5件があり、緩和策を伴うリリースを推奨する。

### 重大度別Findings集計表

| 重大度 | v1.0 検出数 | v2.0 検出数 | 解決済 | 部分解決 | 未解決 |
|:------:|:---:|:---:|:---:|:---:|:---:|
| **Critical** | 4 | 4 | 4 | 0 | **0** |
| **High** | 6 | 13 | 7 | 1 | **5** |
| **Medium** | 20 | 42 | 3 | 2 | **37** |
| **Low** | 8 | 12 | 0 | 0 | **12** |
| **Info** | 0 | 2 | - | - | **-** |
| **合計** | **38** | **73** | **14** | **3** | **54** |

> v2.0では分析観点を拡充し、YouTube API制限・CORS・セッション管理・i18n・全文書下書きステータス等の指摘を新規追加した。

### 重大度分類基準

| 重大度 | 基準 |
|:------:|------|
| **Critical** | リリース阻害またはデータ損失/セキュリティ脆弱性。Go前に解決必須 |
| **High** | 品質・運用への重大リスク。リリース前解決推奨、緩和策付きで受容可 |
| **Medium** | リリース後2週間以内に対応すべき品質・整合性の問題 |
| **Low** | リリース後1ヶ月以内に対応可能な軽微改善 |
| **Info** | 観察事項、肯定的評価、将来検討の推奨 |

### 改善完了サマリー（2026-02-13実施）

#### 追加ドキュメント（16件）

| Phase | ドキュメント | 内容 |
|:-----:|-------------|------|
| UT | UT-CASE-009〜013 | DD-API-011〜015対応の単体テストケース |
| IT | IT-CASE-009〜013 | E2E統合テスト・障害復旧シナリオ |
| AT | AT-SCN-008/009 | メタデータ正規化・タグ管理シナリオ |
| BD | BD-DEP-006 | バックアップ・リカバリ設計 |
| DD | DD-ARCH-002 | Next.js App Router実装ガイド |

#### 修正ドキュメント（5件）

| ドキュメント | 改善内容 |
|-------------|---------|
| RQ-UC-002 | 段階ロード中の操作制限を追加 |
| RQ-GL-015 | 盛り上がり区間の判定アルゴリズムを追加 |
| BD-ARCH-001 | BAT-006/BAT-007とバッチ実行制約を追加 |
| DD-AV-001 | MTTR単一基準化、外部障害判定アルゴリズムを追加 |
| DD-COST-001 | コスト超過検知アルゴリズムを追加 |

---

## 目次

1. [要求の矛盾分析](#1-要求の矛盾分析)
2. [基本設計と要求の整合性](#2-基本設計と要求の整合性)
3. [基本設計の矛盾分析](#3-基本設計の矛盾分析)
4. [詳細設計と基本設計の整合性](#4-詳細設計と基本設計の整合性)
5. [実装可能性の評価](#5-実装可能性の評価)
6. [設計の曖昧性分析](#6-設計の曖昧性分析)
7. [テスト設計のカバレッジ](#7-テスト設計のカバレッジ)
8. [運用設計の評価](#8-運用設計の評価)
9. [非機能要求の達成度](#9-非機能要求の達成度)
10. [規約・ドキュメント標準の評価](#10-規約ドキュメント標準の評価)
11. [改善ロードマップ](#11-改善ロードマップ)
12. [付録A: 文書インベントリ](#付録a-文書インベントリ)
13. [付録B: トレーサビリティギャップマトリクス](#付録b-トレーサビリティギャップマトリクス)
14. [付録C: 分析手法](#付録c-分析手法)

---

## 1. 要求の矛盾分析

**Findings**: 2 Critical (解決済), 2 High, 6 Medium, 2 Low — 計12件

#### [Critical] 段階ロード中の操作制限が未定義
- **ステータス**: 解決済
- **問題**: tag_master取得中にキーワード検索が入力されると、不完全なタグ辞書で検索が実行される可能性
- **参照**: `RQ-UC-002:25-27`, `RQ-FR-008:33-35`
- **影響**: ユーザーが不完全な検索結果を受け取り、存在する動画を見逃す
- **推奨対応**: UC-002に「タグ辞書取得完了まで検索操作を無効化または保留」と明記
- **解決内容**: RQ-UC-002に段階ロード中の操作制限を追記済み

#### [Critical] 盛り上がり区間の定義が設計任せ
- **ステータス**: 解決済
- **問題**: コメント密度波形との対応関係、検出アルゴリズム、複数ある場合の選択基準が未定義
- **参照**: `RQ-UC-006:27`, `RQ-FR-020`
- **影響**: 実装者ごとに異なる盛り上がり判定が発生し、品質のばらつきが生じる
- **推奨対応**: ドメインモデル(RQ-DM-015)で「コメント密度が上位N%を超過する区間」と定義
- **解決内容**: RQ-GL-015に判定アルゴリズム（上位N%閾値方式）を追加済み

#### [High] RTM自動生成の実装確認なし
- **ステータス**: 未解決
- **問題**: `task docs:trace` の実装がRTM正本の生成に必要だが、実装完了の確認が文書上にない
- **参照**: `RQ-RTM-001:39-43`
- **影響**: RTM更新が手動運用に依存し、文書間の整合性が保証されない
- **推奨対応**: `task docs:trace` の実装状態をDD層に記載し、CI統合を検討

#### [High] RDR同時更新の強制がない
- **ステータス**: 未解決
- **問題**: 要求変更時にRDRの同時更新を強制するプロセスゲートがない
- **参照**: `RQ-SC-001:66`
- **影響**: 要求変更の根拠が追跡不能になり、トレーサビリティが断線する
- **推奨対応**: RQ-DG-001のレビューチェックリストにRDR同時更新確認を追加

#### [Medium] 性能要件とコスト制約の調和方法が曖昧
- **ステータス**: 未解決
- **問題**: キャッシュ期間見直し時の性能への影響が明示されていない
- **参照**: `RQ-PS-001:41`, `RQ-COST-001:35-36`
- **影響**: コスト削減のためにキャッシュを短縮した場合、LCP目標を達成できなくなる可能性
- **推奨対応**: RQ-PS-001に「キャッシュ期間変更時の性能影響マトリクス」を追加

#### [Medium] 削除済み動画処理がユースケース/機能要求に欠落
- **ステータス**: 未解決
- **問題**: スコープ(RQ-SC-001)には記載があるが、対応するUCとFRが存在しない
- **参照**: `RQ-SC-001:43`
- **影響**: 削除済み動画の扱いが実装依存になり、一覧に表示され続ける可能性
- **推奨対応**: UC-009「削除済み動画を処理する」と対応FR-026を追加

#### [Medium] タグ辞書の二重管理が曖昧
- **ステータス**: 未解決
- **問題**: DB正本のタグ辞書とJSON配信のタグ辞書の同期タイミング・整合性保証が不明確
- **参照**: `RQ-FR-005:47`, `RQ-FR-019`
- **影響**: 管理画面のタグ変更が公開サイトに反映されないタイミングが生じる
- **推奨対応**: BD-DATA-001にタグ辞書同期フローと整合性保証を明記

#### [Medium] FR-020とFR-022の主従関係が曖昧
- **ステータス**: 未解決
- **問題**: 波形表示(FR-020)と波形データ生成(FR-022)の依存関係が明示されていない
- **参照**: `RQ-FR-020`, `RQ-FR-022`
- **影響**: 生成と表示の開発順序が不明確になり、結合時に不整合が生じる
- **推奨対応**: FR-022をFR-020の前提条件として明示し、依存関係を文書化

#### [Medium] LCP p95 ≤2.5s とクライアントサイド検索のスケーラビリティ矛盾
- **ステータス**: 未解決
- **問題**: RQ-PS-001でLCP p95 ≤2.5sを要求しているが、BD-ADR-005のクライアントサイド検索はデータ量増加でLCPが悪化する構造的リスクがある
- **参照**: `RQ-PS-001`, `BD-ADR-005`
- **影響**: 動画数が数千件を超えた場合、JSONダウンロード+クライアント検索がLCP目標を超過する
- **推奨対応**: BD-ADR-005にスケーラビリティ上限（対応可能な動画件数）を明記し、閾値超過時の移行計画を追加

#### [Medium] LLMタグ提案のエラーハンドリング未定義
- **ステータス**: 未解決
- **問題**: RQ-FR-019とBD-API-002でLLMタグ提案機能が定義されているが、LLM APIのエラー時（タイムアウト、レート制限、不正応答）の挙動が未定義
- **参照**: `RQ-FR-019`, `BD-API-002`
- **影響**: LLM API障害時に管理画面がハングアップまたは不正なタグが提案される
- **推奨対応**: BD-API-002にLLMフォールバック戦略（手動タグ付けへの縮退）を追加

#### [Low] 単一Lambda + 99.5%稼働率のコールドスタート影響
- **ステータス**: 未解決
- **問題**: RQ-AV-001の99.5%稼働率要件に対し、BD-ARCH-001の単一Lambda構成ではコールドスタートが可用性に影響する
- **参照**: `RQ-AV-001`, `BD-ARCH-001`
- **影響**: コールドスタート時の応答遅延が稼働率カウントに含まれるか不明確
- **推奨対応**: 可用性計算においてコールドスタートの扱いを明記（稼働率除外 or Provisioned Concurrency検討）

#### [Low] 月額3,000円上限とフルAWSスタックの制約逼迫
- **ステータス**: 未解決
- **問題**: RQ-COST-001の月額3,000円上限に対し、Lambda+DynamoDB+S3+CloudFront+CloudWatch構成のコスト見積もりに余裕が少ない
- **参照**: `RQ-COST-001`
- **影響**: 予期しないトラフィック増加やログ量増大でコスト上限を超過するリスク
- **推奨対応**: DD-COST-001のコスト内訳に余裕度（バッファ率）を明記

---

## 2. 基本設計と要求の整合性

**Findings**: 1 High (解決済), 2 Medium, 1 Info — 計4件

#### [High] 補助機能の生成責務が不明確
- **ステータス**: 解決済
- **問題**: 波形/ワードクラウド生成のバッチ処理がBD-ARCH-001のバッチ一覧に欠落
- **参照**: `BD-API-001:70`, `BD-ARCH-001:61-69`
- **影響**: 生成バッチの運用設計・監視設計が漏れる
- **推奨対応**: BD-ARCH-001のバッチ一覧を拡張
- **解決内容**: BD-ARCH-001にBAT-006（波形/ワードクラウド生成）、BAT-007（タグマスター更新）を追加済み

#### [Medium] ADR間の依存関係が片方向のみ
- **ステータス**: 未解決
- **問題**: BD-ADR-021からBD-ARCH-001への参照はあるが、逆方向の参照がない
- **参照**: `BD-ADR-021:52-60`, `BD-ARCH-001:10-26`
- **影響**: ADR変更時の影響範囲が片方向からしか追跡できず、設計変更の見落としが生じる
- **推奨対応**: BD-ARCH-001のfrontmatterに`blockedBy: ['BD-ADR-001', 'BD-ADR-021', 'BD-ADR-024']`を追加

#### [Medium] RQ-FR-022/023のRTM-001直接検証リンク欠如
- **ステータス**: 未解決
- **問題**: RTM-001の要求別ビューでRQ-FR-022（波形データ生成）とRQ-FR-023（ワードクラウド画像生成）の検証列が`-`であり、直接的なテストケースが参照されていない
- **参照**: `RQ-RTM-001:84-85`
- **影響**: 波形/ワードクラウド生成機能のテスト網羅性が直接追跡できない
- **推奨対応**: RTM-001の検証列にAT-SCN-003（詳細表示シナリオ）を直接マッピング追加

#### [Info] RTM-001で全FR/NFRにBD/DD設計リンクが存在
- **ステータス**: -
- **問題**: RTM-001の要求別ビューにおいて、全25件のFR要求と全12件のNFR要求に対して、少なくとも1件以上のBD/DD設計文書がリンクされている。設計カバレッジは100%
- **参照**: `RQ-RTM-001:57-116`
- **影響**: 要求から設計への追跡性は良好であり、設計漏れのリスクは低い

---

## 3. 基本設計の矛盾分析

**Findings**: 1 High (解決済), 4 Medium — 計5件

#### [High] バッチ処理設計が不完全
- **ステータス**: 解決済
- **問題**: 波形、ワードクラウド、タグマスター更新のバッチがBD-ARCH-001に未記載
- **参照**: `BD-ARCH-001:61-79`
- **影響**: バッチ運用の設計漏れにより、生成機能が未実装のまま残る
- **推奨対応**: BAT-006/BAT-007を追加
- **解決内容**: BD-ARCH-001にBAT-006/BAT-007と実行制約（最大実行時間、Retry、同時実行数）を追加済み

#### [Medium] API参照系vs更新系の正本が不明確
- **ステータス**: 未解決
- **問題**: BD-API-001（API一覧）とBD-API-002（収集API設計）で同じAPIの定義が異なるレベルで記載されており、正本が不明確
- **参照**: `BD-API-001:52-65`, `BD-API-002:45-66`
- **影響**: API仕様の矛盾が実装時に混乱を引き起こす
- **推奨対応**: BD-API-001を正本一覧とし、BD-API-002を詳細仕様として役割を明記

#### [Medium] LLMタグ取込→再生成の自動トリガー有無が不明
- **ステータス**: 未解決
- **問題**: LLMタグ提案を取り込んだ後、tag_masterの再生成が自動的にトリガーされるのか手動なのかが不明
- **参照**: `BD-DATA-001:58`, `BD-API-002:86-91`
- **影響**: タグ取込後の公開サイトへの反映タイミングが不確定になる
- **推奨対応**: タグ提案取込契約に「反映後処理」セクションを追加し、再生成トリガーを明記

#### [Medium] インフラのHA戦略が不足
- **ステータス**: 未解決
- **問題**: 冗長化、フェイルオーバーの具体的な設計がBD-DEP-001/BD-DEP-004に不足
- **参照**: `BD-DEP-001`, `BD-DEP-004`
- **影響**: 単一AZ障害時のサービス継続が保証されない
- **推奨対応**: 可用性設計として、S3のクロスリージョンレプリケーション検討、CloudFrontのオリジンフェイルオーバー設定を追加

#### [Medium] クライアントサイド検索のスケーラビリティ限界未定義
- **ステータス**: 未解決
- **問題**: BD-ADR-005でクライアントサイド検索を採用しているが、対応可能な動画件数の上限が未定義
- **参照**: `BD-ADR-005`
- **影響**: 動画数の増加に伴いフロントエンドの検索性能が劣化し、性能要件を満たせなくなる
- **推奨対応**: BD-ADR-005に「500件以下: クライアント検索、500件超: サーバー検索移行」等の閾値と移行トリガーを追加

---

## 4. 詳細設計と基本設計の整合性

**Findings**: 2 High (1解決済), 2 Medium — 計4件

#### [High] 全テーブルのカラム詳細定義が不完全
- **ステータス**: 未解決
- **問題**: DD-DDL-001にDDL一覧があり、DD-DDL-002〜014に各テーブル定義が存在するが、一部カラムの型・制約・デフォルト値の詳細が不足している
- **参照**: `DD-DDL-003〜DD-DDL-014`
- **影響**: 実装者がカラム仕様を推測する必要があり、テーブル間の整合性が保証されない
- **推奨対応**: 各DDLドキュメントのカラム定義にNOT NULL/DEFAULT/CHECK制約を追記
- ※ v1.0ではCriticalとしていたが、DDL自体は定義済みのためHighに降格

#### [High] DD-ARCH-002が存在しない
- **ステータス**: 解決済
- **問題**: Next.js App Router (RSC/Client境界) の実装ガイドが欠落していた
- **参照**: BD-ADR-024
- **影響**: フロントエンド実装者がRSC/Client境界の判断を個人裁量で行い、バンドルサイズ増大やハイドレーションエラーが発生する
- **推奨対応**: DD-ARCH-002として新規作成
- **解決内容**: DD-ARCH-002（Next.js App Router実装ガイド）を新規作成済み

#### [Medium] ESLint/tsconfig.json設定が未記載
- **ステータス**: 未解決
- **問題**: DD-CODE-001の規約を強制する実装設定（ESLintルール、tsconfig strict設定）が未記載
- **参照**: `DD-CODE-001`
- **影響**: 規約違反がCIで検出されず、レビュー時の手動確認に依存する
- **推奨対応**: DD-CODE-002としてESLint/tsconfig.json設定仕様を追加

#### [Medium] 冪等性の実装方法が未指定
- **ステータス**: 未解決
- **問題**: DD-API-002で24時間有効期限の冪等性キーが定義されているが、保存先（インメモリ/DB/キャッシュ）が不明
- **参照**: `DD-API-002:70-72`
- **影響**: 実装方式によってLambdaコールドスタート後の冪等性保証が失われる
- **推奨対応**: DynamoDB TTLを利用した冪等性キー管理方式を明記

---

## 5. 実装可能性の評価

**Findings**: 11 Medium (1部分解決), 4 Low — 計15件

### フロントエンド実装可能性: 65%

#### [Medium] コンポーネント責務の曖昧さ（イベント形式未定義）
- **ステータス**: 未解決
- **問題**: DD-UI-002のコンポーネント間通信でイベントペイロード形式が未定義
- **参照**: `DD-UI-002:37-42`
- **影響**: コンポーネント間の型安全性が保証されず、ランタイムエラーが発生する
- **推奨対応**: イベントペイロードのTypeScript型定義を追加

#### [Medium] State管理ライブラリ未選定
- **ステータス**: 未解決
- **問題**: DD-UI-001でState管理の方針は述べられているが、具体的なライブラリが未選定
- **参照**: `DD-UI-001:40-43`
- **影響**: 実装開始時にライブラリ選定の議論が発生し、開発遅延のリスク
- **推奨対応**: Redux/Zustand/React Contextから選定し、ADRで記録

#### [Low] debounce/throttleパラメータ未統一
- **ステータス**: 未解決
- **問題**: 検索バー、フィルタ操作のdebounce/throttle値が統一されていない
- **参照**: `DD-UI-002`
- **影響**: 操作体験のばらつきと性能最適化の困難
- **推奨対応**: 標準パラメータ定義（検索: 300ms debounce等）を追加

### バックエンド実装可能性: 75%

#### [Medium] APIステータス決定表がない
- **ステータス**: 未解決
- **問題**: BD-API-003でエラーモデルは定義されているが、400/422/207の判定基準表がない
- **参照**: `BD-API-003:34-58`
- **影響**: 実装者によってHTTPステータスコードの使い分けが異なる
- **推奨対応**: 判定基準表（入力不正→400、バリデーション→422、部分成功→207）を追加

#### [Medium] エラーコードのAPI別割り当て表がない
- **ステータス**: 未解決
- **問題**: DD-ERR-001に15パターンのエラーコードが定義されているが、各APIでどのコードを返すかの対応表がない
- **参照**: `DD-ERR-001:42-44`
- **影響**: APIごとのエラーレスポンスが統一されず、クライアント側のエラーハンドリングが複雑化
- **推奨対応**: API別エラーコード一覧表を追加

### バッチ実装可能性: 60%

#### [Medium] バッチ実行制約が未定義
- **ステータス**: 部分解決
- **問題**: バッチ処理の最大実行時間、Retry回数、同時実行数が一部未定義
- **参照**: `BD-ARCH-001:61-79`
- **影響**: バッチのタイムアウトやリソース競合で予期しない障害が発生する
- **推奨対応**: BAT-001〜007の全バッチに実行制約を追加
- **解決内容**: BAT-006/007に制約追加済み、BAT-001〜005は残存

#### [Medium] 入力スキーマが未指定
- **ステータス**: 未解決
- **問題**: バッチ処理の入力パラメータの必須/オプション区別が不明
- **参照**: `BD-ARCH-001`
- **影響**: バッチ起動時の入力バリデーションが実装依存になる
- **推奨対応**: 各バッチの入力スキーマ（JSON Schema形式）を追加

#### [Medium] YouTube API レート制限・クォータ枯渇時のエラーハンドリング未指定
- **ステータス**: 未解決
- **問題**: YouTube Data API v3のクォータ制限（10,000 units/day）に達した場合の収集バッチの挙動が未定義
- **参照**: `BD-API-002`, `DD-API-002`
- **影響**: クォータ枯渇時に収集バッチが無限リトライするか、データ欠損が発生する
- **推奨対応**: DD-API-002にクォータ監視とグレースフルデグラデーション（残クォータ確認→中断→翌日再開）を追加

#### [Medium] 同時バッチ実行の上限指定なし
- **ステータス**: 未解決
- **問題**: 複数の収集バッチが同時に起動された場合の制御が未定義（Lambda同時実行数との関係）
- **参照**: `BD-ARCH-001`, `DD-API-002`
- **影響**: 同時実行によるDB負荷増大、YouTube APIクォータの急速消費
- **推奨対応**: BD-ARCH-001に同時実行制御（SQS FIFO or DynamoDBロック）を追加

#### [Medium] 失敗したpublish操作のロールバック手順未定義
- **ステータス**: 未解決
- **問題**: DD-API-014（ドキュメント公開実行API）でpublish操作が部分的に失敗した場合（S3アップロード済み・CloudFront invalidation未完了等）のロールバック手順がない
- **参照**: `DD-API-014`, `DD-DDL-012`, `DD-DDL-013`
- **影響**: 部分的に公開された不整合なアーティファクトがユーザーに配信される
- **推奨対応**: publish_runs/publish_stepsの状態遷移にロールバック状態を追加し、手順を明記

### インフラ実装可能性: 70%

#### [Medium] マルチリージョン/フェイルオーバー設計がない
- **ステータス**: 未解決
- **問題**: 可用性99.5%達成のための冗長化手段が不足
- **参照**: `BD-DEP-001`, `BD-DEP-004`
- **影響**: 単一リージョン障害時にサービス全停止する
- **推奨対応**: CloudFrontオリジンフェイルオーバーの設定仕様を追加

#### [Medium] cdk.context.jsonとの同期方法が不明
- **ステータス**: 未解決
- **問題**: CDKデプロイ時のコンテキスト値管理方法が不明確
- **参照**: `DD-DEP-001:30-34`
- **影響**: 環境差異によるデプロイ失敗
- **推奨対応**: コンテキスト管理方法（Git管理 or パラメータストア）を明記

#### [Low] スキーマバージョン間のデータ移行手順の詳細不足
- **ステータス**: 未解決
- **問題**: DD-MIG-001にマイグレーション方針はあるが、具体的な移行スクリプト仕様が不足
- **参照**: `DD-MIG-001`
- **影響**: スキーマ変更時のデータ移行が場当たり的になる
- **推奨対応**: マイグレーションスクリプトのテンプレートと実行手順を追加

#### [Low] 管理UI画面（UI-A01〜UI-A06）の詳細設計が限定的
- **ステータス**: 未解決
- **問題**: DD-UI-006に管理画面の概要はあるが、各画面（収集状態、配信管理等）の詳細レイアウト・操作フローが不足
- **参照**: `DD-UI-006`
- **影響**: 管理画面の実装がデザイナー任せになる
- **推奨対応**: 各管理画面のワイヤーフレームと操作フローを追加

#### [Low] CDKコンストラクト命名規則・スタック構成が詳細設計に未記載
- **ステータス**: 未解決
- **問題**: DD-DEP-001にデプロイ方式はあるが、CDKのスタック分割やコンストラクト命名規則が未記載
- **参照**: `DD-DEP-001`
- **影響**: CDK実装時にスタック構成の議論が発生し、リファクタリングコストが増加
- **推奨対応**: CDKスタック構成図と命名規則をDD-DEP-001に追加

---

## 6. 設計の曖昧性分析

**Findings**: 1 High (解決済), 5 Medium, 1 Low — 計7件

#### [High] 盛り上がり区間の定義が曖昧
- **ステータス**: 解決済
- **問題**: コメント密度N%超過の具体的な定義がなかった
- **参照**: `RQ-GL-015`, `RQ-FR-020`
- **影響**: 実装者ごとに異なる判定ロジックが適用される
- **推奨対応**: 判定アルゴリズムを明記
- **解決内容**: RQ-GL-015にコメント密度上位N%閾値による判定アルゴリズムを追加済み

#### [Medium] bootstrap初期カード件数が未定義
- **ステータス**: 未解決
- **問題**: 段階ロードのbootstrapフェーズで表示する初期カード件数が未定義
- **参照**: `BD-ADR-002`, `RQ-FR-015`
- **影響**: 初期表示の体験が実装依存になる
- **推奨対応**: 具体的な件数値（例: 20件）をRQ-FR-015に追加

#### [Medium] 最終ページ条件が未明記
- **ステータス**: 未解決
- **問題**: ページング済み索引の最終ページ判定条件が未定義
- **参照**: `RQ-FR-006`, `DD-ALG-001`
- **影響**: 最終ページ到達時の「次へ」ボタン表示の挙動が不明
- **推奨対応**: 総件数/pageSizeの計算式と最終ページ判定ロジックを追加

#### [Medium] 再試行ボタン動作が概要のみ
- **ステータス**: 未解決
- **問題**: エラー時の再試行ボタンの動作が概要レベルで、指数バックオフ設定やタイムアウトが未定義
- **参照**: `DD-UI-002`, `DD-ERR-001`
- **影響**: 再試行の無限ループやサーバー負荷増大のリスク
- **推奨対応**: 指数バックオフ設定（初期1s、最大30s、最大3回）を明記

#### [Medium] 廃止タグの表示挙動が曖昧
- **ステータス**: 未解決
- **問題**: 廃止されたタグの表示方法（グレーアウト？ツールチップ？選択不可？）が「仕様どおり」としか記載されていない
- **参照**: `DD-UI-003`, `RQ-FR-009`
- **影響**: 廃止タグの表示が実装依存になり、ユーザー混乱を招く
- **推奨対応**: 廃止タグの表示仕様（グレーアウト + ツールチップ「廃止済み」+ フィルタ不可）を明記

#### [Medium] ポーリング仕様が未定義
- **ステータス**: 未解決
- **問題**: 収集ジョブ状態のポーリングについて、間隔・タイムアウト・最大回数が未定義
- **参照**: `DD-API-003`, `DD-UI-006`
- **影響**: ポーリングの過剰リクエストでLambdaコストが増加する
- **推奨対応**: ポーリング仕様（間隔5s、タイムアウト300s、最大60回）を追加

#### [Low] 「体感待ちの少ない」主観的表現
- **ステータス**: 未解決
- **問題**: 性能要件に「体感待ちの少ない」という主観的表現が残っている
- **参照**: `RQ-PS-001`
- **影響**: テスト時の合否判定が主観に依存する
- **推奨対応**: 主観表現を削除し、客観的指標（LCP/FID/CLS値）のみに統一

---

## 7. テスト設計のカバレッジ

**Findings**: 4 High (3解決済), 2 Medium, 1 Info — 計7件

### カバレッジ統計（v2.0更新）

| テスト層 | v1.0カバー率 | v2.0カバー率 | 主な変化 |
|---------|:---:|:---:|------|
| 単体テスト(UT) | 53% (8/15 API) | 87% (13/15 API) | UT-CASE-009〜013追加 |
| 結合テスト(IT) | 62% (8/13) | 100% (13/13) | IT-CASE-009〜013追加 |
| 受入テスト(AT) | 56% (14/25 FR) | 80% (20/25 FR) | AT-SCN-008/009追加 |

#### [High] UTカバレッジ漏れ
- **ステータス**: 解決済
- **問題**: DD-API-011/012/013/014/015に対応するUTケースが存在しなかった
- **参照**: `DD-API-011〜015`
- **影響**: 5つのAPIの品質が単体テストレベルで保証されない
- **解決内容**: UT-CASE-009〜013を新規作成し、全15 APIの単体テストカバレッジを確保

#### [High] IT E2Eシナリオ不足
- **ステータス**: 解決済
- **問題**: 収集→タグマスター生成→Web表示までの統合テストがなかった
- **参照**: `IT-PLAN-001`
- **影響**: エンドツーエンドの動作が結合テストレベルで検証されない
- **解決内容**: IT-CASE-009〜013（E2E基本フロー、差分更新、配信反映、障害復旧、データ不整合復旧）を新規作成

#### [High] AT要求カバレッジ不足
- **ステータス**: 解決済
- **問題**: RQ-FR-002/003/004/009の受入シナリオがなかった
- **参照**: `AT-PLAN-001`
- **影響**: 収集・タグ管理の主要機能が受入テストで検証されない
- **解決内容**: AT-SCN-008（メタデータ正規化）、AT-SCN-009（タグ管理運用）を新規作成

#### [High] RTM-001 vs RTM-002 構造的乖離
- **ステータス**: 未解決
- **問題**: RTM-001の要求別ビューでは、RQ-FR-001〜018、RQ-FR-022、RQ-FR-023等の20件以上のFR要求の「検証(UT/IT/AT)」列が`-`（直接テストリンクなし）である。一方、RTM-002のテスト層トレース（max_depth=4の経路判定）では、これら全てが`PASS`と判定されている
- **参照**: `RQ-RTM-001:63-85`, `RQ-RTM-002:186-246`
- **影響**: RTM-001の直接トレーサビリティとRTM-002の間接経路判定の乖離により、テストカバレッジの実態把握が困難。間接パスのみでの`PASS`は、要求→テストの直接的な設計意図を保証しない
- **推奨対応**: RTM-001の検証列に、各FR/NFRの主要テストケースID（UT-CASE/IT-CASE/AT-SCN）を直接マッピング追加。特にRQ-FR-001〜018は対応するAT-SCNが存在するため、直接リンクを追記すべき

#### [Medium] テストの具体性不足
- **ステータス**: 未解決
- **問題**: テストケースの期待値が「確認する」「正しく表示される」等の曖昧な表現に留まり、具体的なJSON構造や観測基準がない
- **参照**: 各UT-CASE/IT-CASE
- **影響**: テスト実行時の合否判定が実行者の主観に依存する
- **推奨対応**: UTテンプレートを標準化し、リクエスト本体/レスポンススキーマをJSON形式で明記

#### [Medium] DD-API-011〜015のIT層カバレッジ
- **ステータス**: 未解決
- **問題**: DD-API-011〜015はUT-CASE（単体テスト）と一部AT-SCN（受入テスト）のマッピングがあるが、RTM-002の設計別ビューでIT-CASE（結合テスト）への直接マッピングがない
- **参照**: `RQ-RTM-002:131-135`
- **影響**: 収集結果明細API、配信前後再確認API等の結合テストカバレッジが間接パス依存
- **推奨対応**: IT-CASE-009〜013のfrontmatterに対応するDD-API-011〜015への`up`リンクを追加

#### [Info] RTM-002のUT/IT/AT全層PASSは間接パス経由であり構造的追跡品質として良好
- **ステータス**: -
- **問題**: RTM-002のテスト層トレース（max_depth=4）において、要求→AT、基本設計→IT、詳細設計→UTの全エントリがPASSである。これは文書間のリンク構造（frontmatter `up`/`related` + 本文`[[ID]]`）が十分に接続されていることを示す
- **参照**: `RQ-RTM-002:185-343`
- **影響**: 間接的ではあるが、全テスト層での追跡可能性は確保されている

---

## 8. 運用設計の評価

**Findings**: 2 Critical (解決済), 1 High (部分解決), 1 Medium (解決済), 1 Medium (未解決), 2 Low — 計7件

#### [Critical] バックアップ・災害復旧計画が完全に欠落
- **ステータス**: 解決済
- **問題**: S3データ、CloudFront設定のバックアップ頻度・保持期間・復旧手順が未定義だった
- **参照**: `BD-DEP-001〜005`
- **影響**: データ消失時にリカバリ不可能
- **解決内容**: BD-DEP-006（バックアップ・リカバリ設計）を新規作成。S3バージョニング、IaCによる構成復元、RTO/RPOを定義

#### [Critical] 可用性計算の障害分類が再現不可能
- **ステータス**: 解決済
- **問題**: 「15分以上断続失敗」基準が離散的で、月次集計時に再現不能だった
- **参照**: `DD-AV-001:47-52`
- **影響**: 可用性SLOの判定が恣意的になる
- **解決内容**: DD-AV-001に外部要因判定アルゴリズム（フローチャート形式）を追加し、月次集計の自動化手順を明記

#### [High] コスト超過検知遅延が恒常的
- **ステータス**: 部分解決
- **問題**: AWSタグ反映遅延48時間+Cost Explorer有効化遅延24時間 = 検知まで最大15営業日
- **参照**: `RQ-COST-001:55`
- **影響**: 月額3,000円超過を月末まで検知できない
- **推奨対応**: AWS Cost Anomaly Detectionを有効化し、日次異常通知を実装
- **解決内容**: DD-COST-001にコスト超過検知閾値と抑制施策を追加。ただしCost Anomaly Detection統合は未実装

#### [Medium] MTTR判定時間帯の複雑性
- **ステータス**: 解決済
- **問題**: 運用時間帯内/外の二重基準が複雑だった
- **参照**: `RQ-AV-001:36`
- **影響**: MTTR計算が再現不能
- **解決内容**: DD-AV-001でMTTR判定を単一基準化（「障害検知から一次復旧まで30分以内」に統一）

#### [Medium] CORSポリシーの明示的仕様がない
- **ステータス**: 未解決
- **問題**: API Gateway / CloudFrontのCORSポリシー（許可オリジン、メソッド、ヘッダー）が設計文書に未記載
- **参照**: `BD-API-005`, `DD-SEC-001`
- **影響**: フロントエンドからのAPI呼び出しがCORSエラーでブロックされる、またはセキュリティ上過度に緩いポリシーが設定される
- **推奨対応**: BD-API-005またはDD-SEC-001にCORSポリシー仕様（`Access-Control-Allow-Origin: https://diopside.example.com`等）を追加

#### [Low] Cookie/セッション管理の明示的仕様がない
- **ステータス**: 未解決
- **問題**: 管理画面の認証にCookie/セッションを使用する場合の仕様（セッション期間、SameSite属性、HttpOnly等）が未記載
- **参照**: `DD-SEC-001`
- **影響**: セッション管理の実装がセキュリティベストプラクティスに沿わない可能性
- **推奨対応**: DD-SEC-001にCookie/セッション管理仕様を追加

#### [Low] CI/CDパイプラインの具体的構成仕様がない
- **ステータス**: 未解決
- **問題**: BD-BUILD-001で「CIチェック必須」と記載されているが、パイプラインのステージ構成（lint→test→build→deploy）の詳細がない
- **参照**: `BD-BUILD-001`
- **影響**: CI/CD構築時にステージ順序やゲート条件が実装依存になる
- **推奨対応**: BD-BUILD-001にパイプラインステージ定義（GitHub Actions workflow構成）を追加

---

## 9. 非機能要求の達成度

**Findings**: 1 Medium (解決済), 1 Medium (部分解決), 1 Medium — 計3件

### 定義済み非機能要求

| カテゴリ | 目標値 | 測定方法 | 状態 |
|---------|--------|----------|:---:|
| 可用性 | 月次99.5%以上 | 経路別2xx/3xx応答の1分バケット集計 | 定義済 |
| 性能(LCP) | p95 2.5秒以下 | CloudWatch + 4G環境実測 | 定義済 |
| 性能(検索) | p95 1.5秒以下 | 同上 | 定義済 |
| 性能(段階ロード) | p95 2.0秒以下 | 同上 | 定義済 |
| 性能(並び替え) | p95 1.0秒以下 | 同上 | 定義済 |
| 可観測性 | ログ記録率99%+、欠測率1%未満 | 必須フィールド充足率監視 | 定義済 |
| セキュリティ | 認証失敗率、認可拒否率 | ログカテゴリ分類で検知 | 定義済 |
| コスト | 月額3,000円以下 | AWS Cost Explorer | 遅延あり |

#### [Medium] コスト達成度の検証遅延
- **ステータス**: 部分解決
- **問題**: 初月の実績把握が15日超後になる可能性
- **参照**: `RQ-COST-001`
- **影響**: コスト超過への対応が月末まで遅れる
- **推奨対応**: Cost Anomaly Detection統合
- **解決内容**: DD-COST-001に検知閾値・抑制施策を追加済みだが、日次通知の具体的実装は未完

#### [Medium] 可観測性証跡の30日制限
- **ステータス**: 未解決
- **問題**: CloudWatch Logsの保持期間が30日に設定されており、31日超過のログは自動削除される
- **参照**: `DD-LOG-001:114-116`
- **影響**: 月次集計で前月データが再計算不能になる可能性（月末締め→翌月初の処理期間中）
- **推奨対応**: 月次集計に必要なメトリクスをS3 or DynamoDBへ日次エクスポート

#### [Medium] MTTR判定の曖昧性
- **ステータス**: 解決済
- **問題**: 運用時間外の障害でMTTR計算が不明確だった
- **参照**: `RQ-AV-001:36`
- **影響**: MTTR SLO達成度が検証不能
- **解決内容**: DD-AV-001で単一基準化（障害検知から一次復旧まで30分以内）に統一

---

## 10. 規約・ドキュメント標準の評価

**Findings**: 1 High, 5 Medium (1解決済), 3 Low — 計9件

### 定義済み規約

| 規約 | ドキュメント | 網羅性 |
|------|:----------:|:---:|
| コーディング規約 | DD-CODE-001 | 80% |
| レビュー規約 | DD-REV-001 | 90% |
| ドキュメント更新フロー | RQ-DG-001 | 95% |

#### [High] 全330文書が status: 下書き
- **ステータス**: 未解決
- **問題**: 全330件のMarkdownドキュメントのfrontmatterで `status: 下書き` が設定されており、正式化（レビュー済み/承認済み）への移行プロセスが定義されていない
- **参照**: 全docs配下のMarkdownファイル
- **影響**: ドキュメントの成熟度が外部から判断できず、実装チームがどの文書を信頼すべきか不明確。AT-GO-001のリリース判定時にも文書ステータスが下書きのままとなる
- **推奨対応**: RQ-DG-001にステータス遷移フロー（下書き→レビュー済→承認済）を追加し、リリース前に主要文書のステータスを更新

#### [Medium] ESLint/tsconfig.json設定の仕様
- **ステータス**: 未解決
- **問題**: DD-CODE-001の規約を実行時に強制する設定ファイルの仕様が欠如
- **参照**: `DD-CODE-001`
- **影響**: 規約がドキュメント上のみで、自動検査に反映されない
- **推奨対応**: DD-CODE-002としてESLint設定・tsconfig.json仕様を追加

#### [Medium] Next.js App Router固有規約
- **ステータス**: 解決済
- **問題**: App Routerの規約（RSC/Client分割、`'use client'`配置基準等）が未定義だった
- **参照**: `BD-ADR-024`
- **影響**: RSC/Client境界の判断が個人裁量になる
- **解決内容**: DD-ARCH-002（Next.js App Router実装ガイド）を新規作成

#### [Medium] traceIdの取得・伝播方法
- **ステータス**: 未解決
- **問題**: DD-CODE-001で「非同期処理はtry/catch + traceId」と規定しているが、traceIdの生成元と伝播方法（リクエストヘッダー? Lambda context?）が未定義
- **参照**: `DD-CODE-001`, `DD-LOG-001`
- **影響**: トレーシングが断片的になり、障害調査時にリクエストの追跡が困難
- **推奨対応**: DD-LOG-001にtraceId生成・伝播パターン（X-Ray or カスタムヘッダー）を追加

#### [Medium] i18n仕様の欠如
- **ステータス**: 未解決
- **問題**: RQ-UX-024で「言語指定（Language of Page/Parts）」が要求されているが、実装仕様（`<html lang="ja">`以外のi18n対応範囲、多言語切替の有無）が未定義
- **参照**: `RQ-UX-024`, `BD-UI-002`
- **影響**: WCAG 2.2 AAの言語指定要件への対応範囲が不明確
- **推奨対応**: BD-UI-002にi18n方針（「日本語単一言語、`lang="ja"`固定」等）を明記

#### [Medium] APIレート制限仕様がない
- **ステータス**: 未解決
- **問題**: diopside APIのレート制限仕様が未定義（<10同時ユーザー想定のみ）
- **参照**: `BD-API-005`, `DD-API-001`
- **影響**: 管理APIへの過剰リクエストによるLambdaコスト増大やサービス不安定化
- **推奨対応**: BD-API-005にAPIレート制限（管理API: 10req/min、公開API: 100req/min等）を追加

#### [Low] Result型の定義
- **ステータス**: 未解決
- **問題**: DD-CODE-001で推奨されるResult型パターンの具体的な型定義がない
- **参照**: `DD-CODE-001`
- **影響**: 実装者ごとに異なるResult型が定義される
- **推奨対応**: 標準Result型定義を追加

#### [Low] Brand/Opaque型の標準定義場所
- **ステータス**: 未解決
- **問題**: DD-CODE-001で推奨されるBrand/Opaque型の配置場所（共通型定義ディレクトリ等）が不明
- **参照**: `DD-CODE-001`
- **影響**: 型定義が分散し、再利用性が低下する
- **推奨対応**: 型定義の配置場所規約を追加

#### [Low] テスト期待値の具体性不足
- **ステータス**: 未解決
- **問題**: テストケースの期待値が「確認する」止まりで、具体的なJSON構造/HTTP ステータスコード/観測メトリクスが不足
- **参照**: 各UT-CASE/IT-CASE/AT-SCN
- **影響**: テスト実行の再現性が低い
- **推奨対応**: テストケーステンプレートに期待値セクション（JSONスキーマ+HTTPステータス+メトリクス条件）を標準化

---

## 11. 改善ロードマップ

### Phase 1: リリース前対応（High優先）

| # | 対応項目 | 重大度 | 対象ドキュメント | 状態 |
|:---:|----------|:---:|----------------|:---:|
| 1 | RTM-001検証列に直接テストマッピング追加 | High | RQ-RTM-001 修正 | 未着手 |
| 2 | 全文書のステータス正式化プロセス定義 | High | RQ-DG-001 修正 | 未着手 |
| 3 | DDLカラム詳細の補完 | High | DD-DDL-003〜014 修正 | 未着手 |
| 4 | RTM自動生成の実装状態確認 | High | DD-API実装確認 | 未着手 |
| 5 | RDR同時更新の強制プロセス追加 | High | RQ-DG-001 修正 | 未着手 |
| ~~6~~ | ~~テストケース追加~~ | ~~High~~ | ~~UT/IT/AT~~ | **完了** |
| ~~7~~ | ~~バックアップ・リカバリ設計~~ | ~~Critical~~ | ~~BD-DEP-006~~ | **完了** |
| ~~8~~ | ~~外部障害判定アルゴリズムの明確化~~ | ~~Critical~~ | ~~DD-AV-001~~ | **完了** |
| ~~9~~ | ~~段階ロード中の操作制限を明記~~ | ~~Critical~~ | ~~RQ-UC-002~~ | **完了** |
| ~~10~~ | ~~盛り上がり区間の定義を追加~~ | ~~Critical~~ | ~~RQ-GL-015~~ | **完了** |

### Phase 2: リリース後2週間以内（Medium優先）

| # | 対応項目 | 重大度 | 対象ドキュメント |
|:---:|----------|:---:|----------------|
| 1 | ESLint/tsconfig.json設定仕様 | Medium | DD-CODE-002 (新規) |
| 2 | YouTube APIレート制限対応 | Medium | DD-API-002 修正 |
| 3 | 同時バッチ実行制御 | Medium | BD-ARCH-001 修正 |
| 4 | publishロールバック手順 | Medium | DD-API-014 修正 |
| 5 | CORSポリシー仕様 | Medium | BD-API-005 修正 |
| 6 | APIレート制限仕様 | Medium | BD-API-005 修正 |
| 7 | i18n方針の明記 | Medium | BD-UI-002 修正 |
| 8 | traceId伝播方法 | Medium | DD-LOG-001 修正 |
| 9 | クライアント検索スケーラビリティ上限 | Medium | BD-ADR-005 修正 |
| 10 | API参照系/更新系の正本明記 | Medium | BD-API-001/002 修正 |
| 11 | DD-API-011〜015のIT層直接マッピング | Medium | IT-CASE-009〜013 修正 |
| 12 | テスト期待値の具体化 | Medium | UT/IT/ATテンプレート修正 |

### Phase 3: リリース後1ヶ月以内（Low優先）

| # | 対応項目 | 重大度 | 対象ドキュメント |
|:---:|----------|:---:|----------------|
| 1 | Cookie/セッション管理仕様 | Low | DD-SEC-001 修正 |
| 2 | CI/CDパイプライン構成仕様 | Low | BD-BUILD-001 修正 |
| 3 | CDKスタック構成・命名規則 | Low | DD-DEP-001 修正 |
| 4 | 管理UI画面の詳細設計 | Low | DD-UI-006 拡張 |
| 5 | スキーマ移行手順の詳細化 | Low | DD-MIG-001 修正 |
| 6 | Result型/Brand型の標準定義 | Low | DD-CODE-001 修正 |
| 7 | debounce/throttle標準パラメータ | Low | DD-UI-002 修正 |

---

## 付録A: 文書インベントリ

**総数**: 330 MD files | **全文書ステータス**: 下書き

### フェーズ別集計

| フェーズ | 文書数 | 主要カテゴリ |
|---------|:---:|------|
| 1. 要求 (RQ) | 149 | PP(3), SC(1), SH(2), PC(9), GL(18), DM(9), UC(9), RDR(37), FR(25), NFR(36), RTM(2), DG(1) |
| 2. 基本設計 (BD) | 51 | ADR(26), ARCH(6), DATA/ERD/RET(3), API(5), UI(4), ENV(2), CM(1), BUILD(1), MON(3), DEP(6), SEC(1), QUAL(1), TST(1) |
| 3. 詳細設計 (DD) | 57 | ARCH/COMP(3), DDL(14), DBCON(2), MIG(1), API(15), UI(6), ALG(1), LOG(2), ERR(1), PERF(1), AV(2), SEC/DEP/SCALE/COST(7), CODE(1), REV(1) |
| 4. 単体テスト (UT) | 48 | PLAN(5), CASE(24), MOCK(1), TDAT(1), COV(1), STAT(1), MET(1), RPT(1), Other(13) |
| 5. 結合テスト (IT) | 21 | PLAN(1), CASE(13), ENV(2), TDAT(1), RST(1), INC(1), Other(2) |
| 6. 受入テスト (AT) | 20 | PLAN(1), SCN(9), OPS(1), REL(1), RUN(1), RCHK(1), GO(1), RPT(1), GUIDE(1), Other(3) |

### 文書一覧

#### 1. 要求 (RQ) — 149件

**プロジェクト定義 (PP/SC/SH/PC) — 15件**

| Doc-ID | タイトル |
|--------|---------|
| RQ-PP-001 | diopsideの目的 |
| RQ-PP-002 | 提供価値の定義 |
| RQ-PP-003 | 成功指標の定義 |
| RQ-SC-001 | diopsideスコープ定義 |
| RQ-SH-001 | 管理者 |
| RQ-SH-002 | 利用者 |
| RQ-PC-001 | 法令遵守制約 |
| RQ-PC-002 | YouTube利用規約制約 |
| RQ-PC-003 | 公開データ限定制約 |
| RQ-PC-004 | 運用体制制約 |
| RQ-PC-005 | 配信基盤制約 |
| RQ-PC-006 | コスト上限制約 |
| RQ-PC-007 | 品質ゲート制約 |
| RQ-PC-008 | セキュリティ制約 |
| RQ-PC-009 | リリース制約 |

**用語定義 (GL) — 18件**

| Doc-ID | タイトル |
|--------|---------|
| RQ-GL-001 | diopside |
| RQ-GL-002 | 収集ジョブ |
| RQ-GL-003 | 公式投稿動画 |
| RQ-GL-004 | 出演動画 |
| RQ-GL-005 | タグ辞書 |
| RQ-GL-006 | アーカイブ索引 |
| RQ-GL-007 | bootstrap |
| RQ-GL-008 | tag_master |
| RQ-GL-009 | archive_index |
| RQ-GL-010 | 段階ロード |
| RQ-GL-011 | 再収集 |
| RQ-GL-012 | 受入判定 |
| RQ-GL-013 | タグ種別 |
| RQ-GL-014 | 検索条件 |
| RQ-GL-015 | 盛り上がり区間 |
| RQ-GL-016 | コメント密度波形 |
| RQ-GL-017 | ワードクラウド |
| RQ-GL-018 | 配信反映実行 |

**ドメインモデル (DM) — 9件**

| Doc-ID | タイトル |
|--------|---------|
| RQ-DM-001 | 動画エンティティ |
| RQ-DM-002 | チャンネルエンティティ |
| RQ-DM-003 | タグエンティティ |
| RQ-DM-004 | タグ種別エンティティ |
| RQ-DM-005 | 収集実行エンティティ |
| RQ-DM-006 | 収集イベントエンティティ |
| RQ-DM-007 | 検索条件モデル |
| RQ-DM-008 | 盛り上がり区間モデル |
| RQ-DM-009 | ワードクラウド成果物モデル |

**ユースケース (UC) — 9件**

| Doc-ID | タイトル |
|--------|---------|
| RQ-UC-001 | 管理者がアーカイブ収集を起動する |
| RQ-UC-002 | 利用者が一覧から動画を閲覧する |
| RQ-UC-003 | 利用者がキーワードで動画を探す |
| RQ-UC-004 | 利用者がタグで動画を絞り込む |
| RQ-UC-005 | 利用者が日付・再生時間で絞り込む |
| RQ-UC-006 | 利用者が動画詳細を確認する |
| RQ-UC-007 | 管理者が収集失敗を調査する |
| RQ-UC-008 | 管理者が再収集を実施する |
| RQ-UC-009 | 管理者が配信前後の再確認と手動タグ付けを実施する |

**要求決定記録 (RDR) — 37件**

| Doc-ID | タイトル |
|--------|---------|
| RQ-RDR-001〜009 | 初期要求決定（収集対象、段階ロード、タグ辞書、検索方式等） |
| RQ-RDR-010〜019 | 運用・制約決定（ステークホルダー統合、制約再定義、UC具体化等） |
| RQ-RDR-020〜029 | 機能・運用拡張決定（波形・ワードクラウド、公開フロー、AIエージェント等） |
| RQ-RDR-030〜037 | 標準化決定（管理画面統合、モバイル優先、静的RTM、経路判定RTM等） |

**機能要求 (FR) — 25件**

| Doc-ID | タイトル |
|--------|---------|
| RQ-FR-001 | 管理画面から公開動画収集ジョブを実行できる |
| RQ-FR-002 | 管理画面で公式投稿の公開動画をチャンネルID一致で取り込める |
| RQ-FR-003 | 管理画面で出演条件一致の公開動画を判定して取り込める |
| RQ-FR-004 | 管理画面の収集結果として動画メタデータを正規化できる |
| RQ-FR-005 | タグ辞書を更新できる |
| RQ-FR-006 | ページング済み索引を生成できる |
| RQ-FR-007 | アーカイブ一覧を表示できる |
| RQ-FR-008 | キーワード検索できる |
| RQ-FR-009 | タグ条件で絞り込みできる |
| RQ-FR-010 | 日付範囲で絞り込みできる |
| RQ-FR-011 | 再生時間で絞り込みできる |
| RQ-FR-012 | 並び順を切り替えできる |
| RQ-FR-013 | 動画詳細モーダルを表示できる |
| RQ-FR-014 | YouTube視聴ページへ遷移できる |
| RQ-FR-015 | 初回読み込みを高速化する段階ロードで漸進表示できる |
| RQ-FR-016 | 管理画面で読み込み失敗を通知できる |
| RQ-FR-017 | 管理画面で収集実行結果を確認できる |
| RQ-FR-018 | 管理画面で手動再収集を実行できる |
| RQ-FR-019 | 管理画面で配信前後のメタデータ再取得と差分確認を運用できる |
| RQ-FR-020 | 詳細画面でコメント密度波形を表示し盛り上がり区間へ遷移できる |
| RQ-FR-021 | 動画詳細でワードクラウドを表示できる |
| RQ-FR-022 | コメント密度波形表示用データを生成できる |
| RQ-FR-023 | ワードクラウド表示用画像を生成できる |
| RQ-FR-024 | 管理画面でドキュメント公開を一括実行できる |
| RQ-FR-025 | 管理画面運用の前提として単一CloudFrontで配信経路をパス分岐できる |

**非機能要求 (NFR) — 36件**

| Doc-ID | タイトル |
|--------|---------|
| RQ-AV-001 | 可用性要件 |
| RQ-PS-001 | 性能要件 |
| RQ-SEC-001 | セキュリティ要件 |
| RQ-PRC-001 | プライバシー要件 |
| RQ-OBY-001 | 可観測性要件 |
| RQ-DEV-001 | DevOps要件 |
| RQ-DEV-002 | AIエージェント運用要件 |
| RQ-INT-001 | 相互運用性要件 |
| RQ-COST-001 | コスト要件 |
| RQ-DATA-001 | データ要件 |
| RQ-UX-001〜024 | ユーザー体験要件（WCAG 2.2 AA準拠、24件） |

**トレーサビリティ・ガイドライン (RTM/DG) — 3件**

| Doc-ID | タイトル |
|--------|---------|
| RQ-RTM-001 | 要求トレーサビリティ（要求別） |
| RQ-RTM-002 | 要求トレーサビリティ（設計別） |
| RQ-DG-001 | ドキュメント更新フロー |

#### 2. 基本設計 (BD) — 51件

| Doc-ID | タイトル |
|--------|---------|
| BD-ADR-001〜026 | アーキテクチャ決定記録（26件） |
| BD-ARCH-001〜006 | システムアーキテクチャ（コンテキスト、論理構成、配置、データフロー、AI運用、インフラ境界） |
| BD-DATA-001 | データアーキテクチャ |
| BD-ERD-001 | ER図（概要） |
| BD-RET-001 | データ保持・削除方針 |
| BD-API-001〜005 | API設計（一覧、収集API、エラーモデル、OpenAPI、契約方針） |
| BD-UI-001〜004 | UI設計（画面一覧、検索画面、画面遷移、アクセシビリティ） |
| BD-ENV-001〜002 | 環境設計（開発、本番） |
| BD-CM-001 | 構成管理方針 |
| BD-BUILD-001 | ビルド方針 |
| BD-MON-001〜003 | 監視設計（監視、SLO運用、インフラ監視） |
| BD-DEP-001〜006 | デプロイ設計（方式、運用ルール、Quartz公開、CloudFront、インフラ、バックアップ） |
| BD-SEC-001 | セキュリティ設計 |
| BD-QUAL-001 | 品質特性 |
| BD-TST-001 | テスト戦略 |

#### 3. 詳細設計 (DD) — 57件

| Doc-ID | タイトル |
|--------|---------|
| DD-ARCH-002 | Next.js App Router実装ガイド |
| DD-COMP-001〜002 | コンポーネント分割、責務対応表 |
| DD-DDL-001〜014 | DDL定義（一覧 + 13テーブル） |
| DD-DBCON-001〜002 | DB制約（方針、一意制約・チェック制約） |
| DD-MIG-001 | DB移行方針 |
| DD-API-001〜015 | API詳細設計（総論 + 14 API） |
| DD-UI-001〜006 | UI詳細（総論、一覧、フィルタ、詳細、検索、運用ステータス） |
| DD-ALG-001 | 検索アルゴリズム |
| DD-LOG-001〜002 | ログ設計（アプリ、インフラ） |
| DD-ERR-001 | エラーコード設計 |
| DD-PERF-001 | 性能設計 |
| DD-AV-001〜002 | 可用性詳細（アプリ、インフラ） |
| DD-SEC-001〜002 | セキュリティ統制（アプリ、インフラ） |
| DD-DEP-001〜003 | デプロイ詳細（方式、CloudFront、インフラ領域分割） |
| DD-SCALE-001 | 拡張性詳細 |
| DD-COST-001 | コスト運用詳細 |
| DD-CODE-001 | コーディング規約 |
| DD-REV-001 | レビュー規約 |

#### 4. 単体テスト (UT) — 48件

| Doc-ID | タイトル |
|--------|---------|
| UT-PLAN-001〜005 | テスト計画（統括、ドキュメント、インフラ、FE、BE） |
| UT-CASE-001〜013 | テストケース（API単体テスト 13件） |
| UT-MOCK-001 | モック方針 |
| UT-TDAT-001 | テストデータ設計 |
| UT-COV-001 | カバレッジ方針 |
| UT-STAT-001 | 静的解析方針 |
| UT-MET-001 | 品質メトリクス |
| UT-RPT-001 | テスト報告 |
| その他 | ポリシー・ガイドライン文書（13件） |

#### 5. 結合テスト (IT) — 21件

| Doc-ID | タイトル |
|--------|---------|
| IT-PLAN-001 | 結合テスト計画 |
| IT-CASE-001〜013 | テストケース（API結合 8件 + E2E/障害復旧 5件） |
| IT-ENV-001〜002 | テスト環境 |
| IT-TDAT-001 | テストデータ設計 |
| IT-RST-001 | テスト結果 |
| IT-INC-001 | インシデントレポート |
| その他 | 補助文書（2件） |

#### 6. 受入テスト (AT) — 20件

| Doc-ID | タイトル |
|--------|---------|
| AT-PLAN-001 | 受入テスト計画 |
| AT-SCN-001〜009 | テストシナリオ（一覧閲覧、検索、詳細、収集、障害、CF分岐、再確認、メタデータ、タグ管理） |
| AT-OPS-001 | 運用受入チェックリスト |
| AT-REL-001 | 配信手順書 |
| AT-RUN-001 | 障害対応手順書 |
| AT-RCHK-001 | リリースチェックリスト |
| AT-GO-001 | リリース判定 |
| AT-RPT-001 | 受入テスト報告 |
| AT-GUIDE-001 | ユーザーガイド |
| その他 | 補助文書（3件） |

---

## 付録B: トレーサビリティギャップマトリクス

RTM-001（要求別ビュー）の「検証(UT/IT/AT)」列と、RTM-002（テスト層トレース）の経路判定結果を比較した表。

### 機能要求 (FR) のトレーサビリティギャップ

| 要求ID | タイトル | RTM-001 直接検証リンク | RTM-002 経路判定 | ギャップ |
|--------|---------|:---:|:---:|:---:|
| RQ-FR-001 | 収集ジョブ実行 | `-` | PASS | **GAP** |
| RQ-FR-002 | 公式動画取込 | `-` | PASS | **GAP** |
| RQ-FR-003 | 出演動画判定 | `-` | PASS | **GAP** |
| RQ-FR-004 | メタデータ正規化 | `-` | PASS | **GAP** |
| RQ-FR-005 | タグ辞書更新 | `-` | PASS | **GAP** |
| RQ-FR-006 | ページング索引生成 | `-` | PASS | **GAP** |
| RQ-FR-007 | アーカイブ一覧表示 | `-` | PASS | **GAP** |
| RQ-FR-008 | キーワード検索 | `-` | PASS | **GAP** |
| RQ-FR-009 | タグ絞り込み | `-` | PASS | **GAP** |
| RQ-FR-010 | 日付範囲絞り込み | `-` | PASS | **GAP** |
| RQ-FR-011 | 再生時間絞り込み | `-` | PASS | **GAP** |
| RQ-FR-012 | 並び替え | `-` | PASS | **GAP** |
| RQ-FR-013 | 動画詳細モーダル | `-` | PASS | **GAP** |
| RQ-FR-014 | YouTube遷移 | `-` | PASS | **GAP** |
| RQ-FR-015 | 段階ロード | `-` | PASS | **GAP** |
| RQ-FR-016 | 読み込み失敗通知 | `-` | PASS | **GAP** |
| RQ-FR-017 | 収集結果確認 | `-` | PASS | **GAP** |
| RQ-FR-018 | 手動再収集 | `-` | PASS | **GAP** |
| RQ-FR-019 | 配信前後再確認 | AT-PLAN-001, AT-SCN-007 | PASS | - |
| RQ-FR-020 | コメント密度波形 | AT-PLAN-001, AT-SCN-003 | PASS | - |
| RQ-FR-021 | ワードクラウド表示 | AT-PLAN-001, AT-SCN-003 | PASS | - |
| RQ-FR-022 | 波形データ生成 | `-` | PASS | **GAP** |
| RQ-FR-023 | ワードクラウド画像生成 | `-` | PASS | **GAP** |
| RQ-FR-024 | ドキュメント公開 | AT-PLAN-001, AT-REL-001 | PASS | - |
| RQ-FR-025 | CloudFrontパス分岐 | AT-SCN-006 | PASS | - |

### 非機能要求 (NFR) のトレーサビリティギャップ

| 要求ID | タイトル | RTM-001 直接検証リンク | RTM-002 経路判定 | ギャップ |
|--------|---------|:---:|:---:|:---:|
| RQ-AV-001 | 可用性 | AT-GO/OPS/PLAN/RPT | PASS | - |
| RQ-COST-001 | コスト | AT-OPS-001 | PASS | - |
| RQ-DATA-001 | データ | AT-SCN-004 | PASS | - |
| RQ-DEV-001 | DevOps | AT-GO/REL/RUN | PASS | - |
| RQ-DEV-002 | AIエージェント | `-` | PASS | **GAP** |
| RQ-PS-001 | 性能 | AT-GO/OPS/PLAN/RPT | PASS | - |
| RQ-SEC-001 | セキュリティ | AT-OPS/RPT/RUN | PASS | - |
| RQ-OBY-001 | 可観測性 | AT-GO/OPS/RPT | PASS | - |
| RQ-INT-001 | 相互運用性 | AT-SCN-004 | PASS | - |
| RQ-PRC-001 | プライバシー | AT-OPS-001 | PASS | - |
| RQ-UX-001 | ユーザー体験 | AT-RPT/SCN-002 | PASS | - |
| RQ-UX-019 | HTML/ARIA準拠 | `-` | PASS | **GAP** |
| RQ-UX-021 | CI/CDアクセシビリティ | `-` | PASS | **GAP** |
| RQ-UX-024 | 言語指定 | AT-SCN-001 | PASS | - |

**ギャップ合計**: FR 20件 + NFR 3件 = **23件**（全てRTM-002ではPASS）

### 分析

RTM-001で直接検証リンクが`-`の23要求は、RTM-002のmax_depth=4経路判定では全てPASSとなっている。これは文書間のリンク構造が十分に接続されているためだが、「要求→テスト」の直接的な設計意図が文書上で可視化されていないリスクがある。推奨対応としてRTM-001の検証列への直接マッピング追加をPhase 1ロードマップに含めている。

---

## 付録C: 分析手法

### 追跡方法
- **リンク抽出**: 各文書のfrontmatter（`up` / `related`）および本文のWikiリンク `[[ID]]` を抽出
- **経路探索**: `max_depth=4` での双方向経路探索（`traceability.py`）
- **判定基準**: 対応するケース/シナリオ（AT-SCN, IT-CASE, UT-CASE）に到達できれば `PASS`

### 分析観点（10観点）
1. **要求の矛盾分析**: FR/NFR間、要求間の矛盾・競合を検出
2. **基本設計と要求の整合性**: BD文書がRQ要求を網羅的にカバーしているか
3. **基本設計の矛盾分析**: BD文書間の矛盾・不整合を検出
4. **詳細設計と基本設計の整合性**: DD文書がBD設計を具体化しているか
5. **実装可能性の評価**: 設計文書だけで実装を開始できるか
6. **設計の曖昧性分析**: 曖昧な表現・未定義の仕様を検出
7. **テスト設計のカバレッジ**: UT/IT/ATがDD/BD/RQを網羅しているか
8. **運用設計の評価**: 運用に必要な情報が設計文書に含まれているか
9. **非機能要求の達成度**: NFR目標値の測定可能性と達成見込み
10. **規約・ドキュメント標準の評価**: コーディング/レビュー/文書標準の網羅性

### ツール
- `task docs:guard`: 文書整合チェック
- `task docs:trace`: RTM静的ビューの自動生成
- `traceability.py`: 個別追跡スクリプト（経路探索）

### 変更履歴
- v2.0 (2026-02-13): 重大度分類統一、10分析セクション拡充、付録A/B/C追加、HTML版強化
- v1.0 (2026-02-12): 初版作成

---

*Generated by Claude Code Analysis | 2026-02-13*
*Version: 2.0*
