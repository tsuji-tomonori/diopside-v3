# 影響確認レポート

- 日付: 2026-02-11
- 対象: `docs/1.要求(RQ)/61.非機能要求(NFR)` 配下10文書、`RQ-RDR-017`
- 判定: NFRテンプレート文をカテゴリ別・数値閾値付きの要求へ具体化。

## 実施内容
- `RQ-AV-001`〜`RQ-DATA-001` の SnowCard を個別化し、受入基準へ測定可能な閾値を追加。
- 各NFRの `related` を設計/運用文書に合わせて見直し、一律参照を解消。
- 意味変更の決定記録として `RQ-RDR-017` を新規追加。

## 影響確認
- 要求整合: `[[RQ-SC-001]]` のMVP完了条件（NFR受入確認）に対して、判定可能な閾値が定義された。
- 設計整合: `[[BD-QUAL-001]]` / `[[BD-SEC-001]]` / `[[DD-AV-001]]` / `[[DD-PERF-001]]` / `[[DD-LOG-001]]` / `[[DD-COST-001]]` へのトレースを付与。
- 受入整合: `[[AT-PLAN-001]]` / `[[AT-RPT-001]]` / `[[AT-GO-001]]` で閾値判定結果を記録できる構成を維持。

## 検証
- `python3 .opencode/skills/obsidian-doc-check/scripts/validate_vault.py --docs-root docs --report reports/doc_check.md` を実行し、リンク/整合性に問題がないことを確認。

## 追記（収集要件の表現具体化）
- 対象: `RQ-FR-002`, `RQ-FR-003`
- 実施: 「収集できる」を、判定条件（公式チャンネルID一致/出演判定条件）と対象状態（公開動画）を明示した要件文へ更新。
- 反映: 両文書の `version` を `1.0.4` へ更新。
- 判定: 収集可否の判断条件が本文で一意に読める記述となり、レビュー時の解釈差分を低減。

## 追記（WCAG 2.2 AA相当UX要求の追加）
- 対象: `RQ-UX-001`〜`RQ-UX-024`, `RQ-RDR-018`
- 実施:
  - UX詳細要求を `RQ-UX-002`〜`RQ-UX-024` として新規追加（1トピック1ファイル）。
  - `RQ-UX-001` を総則として位置づけ、詳細要求への参照リンクを追加。
  - 要求追加の決定記録として `RQ-RDR-018` を新規作成。
- 影響確認:
  - 要求整合: WCAG観点（代替テキスト、入力支援、認証、言語指定、CI/CDゲート等）を要求レベルで網羅。
  - 設計/受入整合: `BD-UI-002` / `BD-SEC-001` / `BD-BUILD-001` / `AT-SCN-002` へのトレースを付与。

## 追記（詳細画面ワードクラウド要求の追加）
- 対象: `RQ-FR-021`, `RQ-RDR-021`, `RQ-UC-006`, `RQ-SC-001`, `RQ-PC-003`, `RQ-PRC-001`, `RQ-FR-013`
- 実施:
  - 詳細画面で公開チャット由来の集計結果から生成されたワードクラウドを表示する機能要求 `RQ-FR-021` を新規追加。
  - 採用判断を `RQ-RDR-021` に記録し、POC（`.workspace/CreateWordCloudService`）準拠の要件境界を明文化。
  - `RQ-UC-006` にワードクラウド確認導線と未生成時の代替フローを追記。
  - `RQ-SC-001` / `RQ-PC-003` / `RQ-PRC-001` を更新し、チャット生データ非保存を維持したまま非可逆派生物の利用を許容する境界を追加。
- 影響確認:
  - 要求整合: 詳細表示要求（`RQ-FR-013`）とワードクラウド要求（`RQ-FR-021`）の責務分担を維持。
  - 制約整合: 公開データ限定・プライバシー要件と矛盾しない運用条件（生データ0件、派生物のみ保持）を定義。
  - スコープ整合: DoD の Must機能要求範囲を `RQ-FR-021` まで更新。

## 追記（ワードクラウド静的画像配信の設計反映）
- 対象: `BD-API-001`, `BD-UI-002`, `BD-UI-004`, `BD-ADR-009`, `AT-PLAN-001`, `AT-SCN-003`
- 実施:
  - `BD-ADR-009` を新規追加し、ワードクラウドの配信方式を「事前生成の静的画像配信」として決定。
  - `BD-API-001` に `wordcloud/{videoId}.png` 契約、HTTPステータス運用、フォールバック方針を追記。
  - `BD-UI-002` と `BD-UI-004` に詳細モーダルの表示条件、代替表示、再試行導線、代替テキスト要件を追記。
  - `AT-PLAN-001` / `AT-SCN-003` に `[[RQ-FR-021]]` 受入観点（表示成功/未生成/取得失敗）を追加。
- 影響確認:
  - 設計整合: `RQ-RDR-021 -> BD-ADR-009 -> BD-API/UI` のトレース経路を構築。
  - 受入整合: `AT-SCN-003` でタイムスタンプ観点とワードクラウド観点を同時検証可能。
  - 運用整合: 動的APIを追加せず、静的配信前提の既存運用モデルを維持。

## 追記（詳細画面タイムスタンプ表示と該当秒遷移要求の追加）
- 対象: `RQ-FR-020`, `RQ-RDR-020`, `RQ-UC-006`, `RQ-SC-001`
- 実施:
  - 詳細画面でタイムスタンプ一覧を表示し、選択時にYouTube該当秒へ遷移する機能要求 `RQ-FR-020` を新規追加。
  - 要求追加の決定記録として `RQ-RDR-020` を新規作成。
  - 利用シナリオ整合のため `RQ-UC-006` にタイムスタンプ操作フローを反映。
  - MVP完了条件のMust範囲を `RQ-FR-020` まで拡張するため `RQ-SC-001` を更新。
- 影響確認:
  - 要求整合: `RQ-FR-013`（詳細表示）と `RQ-FR-014`（外部遷移）を跨ぐ導線を独立要求として判定可能化。
  - 受入整合: タイムスタンプ未生成時の代替表示と、`t=<秒数>` 付き遷移の双方をAT観点に追加可能な構成を維持。
  - 根拠整合: POC（`.workspace/CreateTimestamp`）で確認済みの時刻整形・秒数算出方針を要求根拠として記録。

## 追記（配信前後メタデータ再確認要求の追加）
- 対象: `RQ-FR-019`, `RQ-RDR-019`, `RQ-SC-001`
- 実施:
  - 配信前メタデータ取得と配信後再確認を自動化し、差分有無を記録する機能要求 `RQ-FR-019` を新規追加。
  - 配信結果タグ付けを自動化せず管理者手動運用とする決定記録 `RQ-RDR-019` を新規作成。
  - `RQ-SC-001` の DoD における Must機能要求範囲を `RQ-FR-019` まで更新。
- 影響確認:
  - 要求整合: 収集精度向上（配信前後差分追跡）と運用品質担保（タグ付け手動判断）の責務境界を明文化。
  - 既存要求整合: `RQ-FR-004`（正規化）、`RQ-FR-005`（タグ辞書）、`RQ-FR-017`（実行結果確認）との重複を回避し連携関係を保持。
  - 参考実装整合: `.workspace/NotifyDeliveryScheduleApp` の定期取得・差分判定方針と矛盾しない要求粒度で記述。

## 追記（運用シナリオUCの追加）
- 対象: `RQ-UC-009`, `RQ-FR-019`, `RQ-RDR-019`
- 実施:
  - 配信前確認→配信後再確認→手動タグ付けを明示したユースケース `RQ-UC-009` を新規追加。
  - `RQ-FR-019` の `up` と依存・関連へ `RQ-UC-009` を追加し、要求から運用シナリオへのトレースを補強。
  - `RQ-RDR-019` の影響範囲へ `RQ-UC-009` を追記し、要求追加時の決定記録を同一変更で更新。
- 影響確認:
  - 要求/UC整合: 自動処理（メタデータ再確認）と手動処理（タグ付け）の責務境界がユースケース上でも一意に読める。
  - 運用整合: 再確認失敗時の `[[RQ-UC-007]]` への遷移導線を保持し、既存運用フローと接続できる。

## 追記（ATへの `RQ-FR-020` 受入展開）
- 対象: `AT-PLAN-001`, `AT-SCN-003`
- 実施:
  - `AT-PLAN-001` の対象範囲へタイムスタンプ表示・該当秒遷移を追加。
  - 判定基準へ `[[RQ-FR-020]]` の観点（表示、`t=<秒数>` 遷移、未生成時代替表示）を明示。
  - `AT-SCN-003` を「詳細表示・タイムスタンプ遷移」シナリオへ更新し、手順・期待結果・記録項目を具体化。
- 影響確認:
  - 受入整合: 要求追加 `[[RQ-FR-020]]` からATシナリオまでのトレースが成立。
  - 判定整合: 既存の詳細表示/外部遷移判定に、秒指定遷移と未生成時挙動の判定軸を追加。

## 追記（既存収集UCからの導線補強）
- 対象: `RQ-UC-001`
- 実施:
  - `related` に `[[RQ-UC-009]]` と `[[RQ-FR-019]]` を追加し、収集起動から配信前後再確認・手動タグ付け運用までのトレースを明示。
- 影響確認:
  - ユースケース整合: 既存の収集起動シナリオと新規運用シナリオの接続が文書上で追跡可能になった。

## 追記（詳細機能の生成責務をDATへ追加）
- 対象: `RQ-FR-022`, `RQ-FR-023`, `RQ-RDR-022`, `RQ-FR-020`, `RQ-FR-021`, `RQ-SC-001`
- 実施:
  - タイムスタンプ表示用データ生成要求 `RQ-FR-022` を DAT として新規追加。
  - ワードクラウド表示用画像生成要求 `RQ-FR-023` を DAT として新規追加。
  - 表示要求（`RQ-FR-020` / `RQ-FR-021`）と生成要求（`RQ-FR-022` / `RQ-FR-023`）を分離する決定記録 `RQ-RDR-022` を新規作成。
  - `RQ-FR-020` / `RQ-FR-021` の `related` へ生成要求を追記し、責務境界のトレースを補強。
  - `RQ-SC-001` の対象機能と DoD 範囲を `RQ-FR-023` まで更新。
- 影響確認:
  - 要求整合: DET（表示）と DAT（生成）の責務境界が要求文書で一意に読める構成になった。
  - 受入整合: 表示不具合と生成不具合を受入判定時に切り分け可能になった。
  - 制約整合: `RQ-PRC-001` / `RQ-PC-003` の生データ非保存方針を、生成要求側の受入基準へ反映した。

## 追記（プロジェクト名の理由・意図の明文化）
- 対象: `RQ-GL-001`, `RQ-PP-001`
- 実施:
  - `RQ-GL-001` の定義表へ、`diopside` の命名理由（石言葉「幸せへの道標」）と命名意図を追記。
  - `RQ-PP-001` に「プロジェクト名の理由と意図」節を追加し、目的文書から名称の背景を参照可能化。
- 影響確認:
  - 要求整合: スコープ/目的/用語で `diopside` の意味と価値観を一貫して説明できる。
  - 文書運用整合: 命名背景の説明が要求文書内で完結し、レビュー時の解釈差分を低減。

## 追記（UC主体のステークホルダーリンク化）
- 対象: `RQ-UC-007`
- 実施:
  - 本文中の主体「管理者」を `[[RQ-SH-001|管理者]]` へリンク化し、ステークホルダー定義への参照を明示。
  - frontmatter の `version` を `1.0.4` へ更新し、`updated` と変更履歴を当日更新。
- 影響確認:
  - 要求整合: UC本文からステークホルダー定義へ一意に遷移でき、主体解釈の曖昧さを低減。

## 追記（`RQ-FR-020` の意味変更: タイムスタンプ一覧 -> コメント密度波形）
- 対象: `RQ-FR-020`, `RQ-RDR-020`, `RQ-FR-022`, `RQ-RDR-022`, `RQ-UC-006`, `RQ-SC-001`, `RQ-GL-015`, `RQ-GL-016`, `RQ-DM-008`, `RQ-DM-001`, `BD-ADR-010`, `BD-API-001`, `BD-UI-002`, `BD-UI-004`, `AT-PLAN-001`, `AT-SCN-003`
- 実施:
  - `RQ-FR-020` を「コメント密度波形を表示し盛り上がり区間へ遷移する要求」へ意味変更。
  - `RQ-RDR-020` を更新し、POC（`.workspace/CreateTimestamp`）の密度抽出意図を採用理由として明文化。
  - 用語 `RQ-GL-015`（盛り上がり区間）/ `RQ-GL-016`（コメント密度波形）を新規追加。
  - ドメイン `RQ-DM-008`（盛り上がり区間モデル）を新規追加し、`RQ-DM-001` へ関連追記。
  - 生成要求 `RQ-FR-022` と分離決定 `RQ-RDR-022` を波形データ前提へ更新。
  - 設計は `BD-ADR-010 -> BD-API-001 -> BD-UI-002/004` で、`highlights/{videoId}.json` 契約と波形UI要件へ更新。
  - 受入は `AT-PLAN-001` / `AT-SCN-003` を波形表示・区間クリック遷移観点へ更新。
- 影響確認:
  - 要求整合: 「コメント密度を測定し、高密度区間を残す」という意図が要求本文で直接読める構成になった。
  - 用語/ドメイン整合: UI語彙（波形・区間）とデータ語彙（区間境界・密度指標）が文書横断で一致。
  - 設計/受入整合: 可視化契約、操作仕様、判定観点が一貫して追跡可能。

## 追記（TypeScript型安全方針のBD反映）
- 対象: `BD-BUILD-001`, `BD-ADR-011`, `.opencode/skills/doc-bd-build/SKILL.md`, `.opencode/skills/doc-bd-build/TEMPLATE.md`
- 実施:
  - `BD-BUILD-001` を更新し、TypeScript型安全の標準設定（`strict`、`noUncheckedIndexedAccess`、`exactOptionalPropertyTypes`、`useUnknownInCatchVariables`）と受入基準を追加。
  - `BD-ADR-011` を新規作成し、型安全を `tsconfig` + lint の品質ゲートで標準化する決定を記録。
  - `doc-bd-build` スキルに、型安全方針をBD-BUILD更新時の必須観点として追加。
  - `doc-bd-build` テンプレートに、型安全章立て（tsconfig/lint/受入基準）を追加。
- 影響確認:
  - 要求整合: `[[RQ-DEV-001]]` の `lint/test/build` 必須化と、型安全ゲートの導入方針が整合。
  - 設計整合: `[[BD-BUILD-001]]` から `[[DD-CODE-001]]` への規約展開が可能なトレースを確保。
  - 運用整合: スキル更新により、今後のBD-BUILD更新でも同方針を継続適用できる。

## 追記（NFRと制約の整合条件明確化）
- 対象: `RQ-AV-001`, `RQ-PS-001`, `RQ-OBY-001`, `RQ-INT-001`, `RQ-DATA-001`, `RQ-UX-003`, `RQ-UX-014`, `RQ-UX-016`, `RQ-UX-020`, `RQ-UX-022`, `RQ-UX-023`, `RQ-RDR-023`
- 実施:
  - NFR整合チェックで抽出した要確認項目について、運用時間帯、計測条件、例外条件、MVP適用条件を本文へ追記。
  - `RQ-RDR-023` を新規追加し、制約（`RQ-PC-002` / `RQ-PC-004` / `RQ-PC-006`）とNFRの整合方針を決定記録化。
  - UX要件はスコープ境界に合わせ、管理者向け導線適用・将来拡張適用の条件を明確化。
- 影響確認:
  - 要求整合: 明確な矛盾を追加せず、要確認事項を判定可能条件へ変換。
  - 制約整合: 個人運用体制、APIクォータ制約、月額コスト上限を前提にした運用可能な要件へ補正。
  - 受入整合: 例外時の判定基準が定義され、ATでの再現可能性を向上。
