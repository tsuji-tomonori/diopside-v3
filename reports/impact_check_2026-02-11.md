# 影響確認レポート

- 日付: 2026-02-11
- 対象: `docs/1.要求(RQ)/61.非機能要求(NFR)` 配下10文書、`RQ-RDR-017`
- 判定: NFRテンプレート文をカテゴリ別・数値閾値付きの要求へ具体化。

## 実施内容
- `RQ-AV-001`〜`RQ-DATA-001` の SnowCard を個別化し、受入基準へ測定可能な閾値を追加。
- 各NFRの `related` を設計/運用文書に合わせて見直し、一律参照を解消。
- 意味変更の決定記録として `RQ-RDR-017` を新規追加。

## 影響確認
- 要求整合: [[RQ-SC-001]] のMVP完了条件（NFR受入確認）に対して、判定可能な閾値が定義された。
- 設計整合: [[BD-QUAL-001]] / [[BD-SEC-001]] / [[DD-AV-001]] / [[DD-PERF-001]] / [[DD-LOG-001]] / [[DD-COST-001]] へのトレースを付与。
- 受入整合: [[AT-PLAN-001]] / [[AT-RPT-001]] / [[AT-GO-001]] で閾値判定結果を記録できる構成を維持。

## 検証
- `python3 .opencode/skills/obsidian-doc-check/scripts/validate_vault.py --docs-root docs --report reports/doc_check.md` を実行し、リンク/整合性に問題がないことを確認。

## 追記（収集要件の表現具体化）
- 対象: `RQ-FR-002`, `RQ-FR-003`
- 実施: 「収集できる」を、判定条件（公式チャンネルID一致/出演判定条件）と対象状態（公開動画）を明示した要件文へ更新。
- 反映: 両文書の `version` を `1.0.4` へ更新。
- 判定: 収集可否の判断条件が本文で一意に読める記述となり、レビュー時の解釈差分を低減。

## 追記（WCAG 2.2 AA相当UX要求の追加）
- 対象: `RQ-UX-001`〜`RQ-UX-024`, `RQ-RDR-018`
- 実施:
  - UX詳細要求を `RQ-UX-002`〜`RQ-UX-024` として新規追加（1トピック1ファイル）。
  - `RQ-UX-001` を総則として位置づけ、詳細要求への参照リンクを追加。
  - 要求追加の決定記録として `RQ-RDR-018` を新規作成。
- 影響確認:
  - 要求整合: WCAG観点（代替テキスト、入力支援、認証、言語指定、CI/CDゲート等）を要求レベルで網羅。
  - 設計/受入整合: `BD-UI-002` / `BD-SEC-001` / `BD-BUILD-001` / `AT-SCN-002` へのトレースを付与。

## 追記（詳細画面ワードクラウド要求の追加）
- 対象: `RQ-FR-021`, `RQ-RDR-021`, `RQ-UC-006`, `RQ-SC-001`, `RQ-PC-003`, `RQ-PRC-001`, `RQ-FR-013`
- 実施:
  - 詳細画面で公開チャット由来の集計結果から生成されたワードクラウドを表示する機能要求 `RQ-FR-021` を新規追加。
  - 採用判断を `RQ-RDR-021` に記録し、POC（`.workspace/CreateWordCloudService`）準拠の要件境界を明文化。
  - `RQ-UC-006` にワードクラウド確認導線と未生成時の代替フローを追記。
  - `RQ-SC-001` / `RQ-PC-003` / `RQ-PRC-001` を更新し、チャット生データ非保存を維持したまま非可逆派生物の利用を許容する境界を追加。
- 影響確認:
  - 要求整合: 詳細表示要求（`RQ-FR-013`）とワードクラウド要求（`RQ-FR-021`）の責務分担を維持。
  - 制約整合: 公開データ限定・プライバシー要件と矛盾しない運用条件（生データ0件、派生物のみ保持）を定義。
  - スコープ整合: DoD の Must機能要求範囲を `RQ-FR-021` まで更新。

## 追記（ワードクラウド静的画像配信の設計反映）
- 対象: `BD-API-001`, `BD-UI-002`, `BD-UI-004`, `BD-ADR-009`, `AT-PLAN-001`, `AT-SCN-003`
- 実施:
  - `BD-ADR-009` を新規追加し、ワードクラウドの配信方式を「事前生成の静的画像配信」として決定。
  - `BD-API-001` に `wordcloud/{videoId}.png` 契約、HTTPステータス運用、フォールバック方針を追記。
  - `BD-UI-002` と `BD-UI-004` に詳細モーダルの表示条件、代替表示、再試行導線、代替テキスト要件を追記。
  - `AT-PLAN-001` / `AT-SCN-003` に [[RQ-FR-021]] 受入観点（表示成功/未生成/取得失敗）を追加。
- 影響確認:
  - 設計整合: `RQ-RDR-021 -> BD-ADR-009 -> BD-API/UI` のトレース経路を構築。
  - 受入整合: `AT-SCN-003` でタイムスタンプ観点とワードクラウド観点を同時検証可能。
  - 運用整合: 動的APIを追加せず、静的配信前提の既存運用モデルを維持。

## 追記（詳細画面タイムスタンプ表示と該当秒遷移要求の追加）
- 対象: `RQ-FR-020`, `RQ-RDR-020`, `RQ-UC-006`, `RQ-SC-001`
- 実施:
  - 詳細画面でタイムスタンプ一覧を表示し、選択時にYouTube該当秒へ遷移する機能要求 `RQ-FR-020` を新規追加。
  - 要求追加の決定記録として `RQ-RDR-020` を新規作成。
  - 利用シナリオ整合のため `RQ-UC-006` にタイムスタンプ操作フローを反映。
  - MVP完了条件のMust範囲を `RQ-FR-020` まで拡張するため `RQ-SC-001` を更新。
- 影響確認:
  - 要求整合: `RQ-FR-013`（詳細表示）と `RQ-FR-014`（外部遷移）を跨ぐ導線を独立要求として判定可能化。
  - 受入整合: タイムスタンプ未生成時の代替表示と、`t=<秒数>` 付き遷移の双方をAT観点に追加可能な構成を維持。
  - 根拠整合: POC（`.workspace/CreateTimestamp`）で確認済みの時刻整形・秒数算出方針を要求根拠として記録。

## 追記（配信前後メタデータ再確認要求の追加）
- 対象: `RQ-FR-019`, `RQ-RDR-019`, `RQ-SC-001`
- 実施:
  - 配信前メタデータ取得と配信後再確認を自動化し、差分有無を記録する機能要求 `RQ-FR-019` を新規追加。
  - 配信結果タグ付けを自動化せず管理者手動運用とする決定記録 `RQ-RDR-019` を新規作成。
  - `RQ-SC-001` の DoD における Must機能要求範囲を `RQ-FR-019` まで更新。
- 影響確認:
  - 要求整合: 収集精度向上（配信前後差分追跡）と運用品質担保（タグ付け手動判断）の責務境界を明文化。
  - 既存要求整合: `RQ-FR-004`（正規化）、`RQ-FR-005`（タグ辞書）、`RQ-FR-017`（実行結果確認）との重複を回避し連携関係を保持。
  - 参考実装整合: `.workspace/NotifyDeliveryScheduleApp` の定期取得・差分判定方針と矛盾しない要求粒度で記述。

## 追記（運用シナリオUCの追加）
- 対象: `RQ-UC-009`, `RQ-FR-019`, `RQ-RDR-019`
- 実施:
  - 配信前確認→配信後再確認→手動タグ付けを明示したユースケース `RQ-UC-009` を新規追加。
  - `RQ-FR-019` の `up` と依存・関連へ `RQ-UC-009` を追加し、要求から運用シナリオへのトレースを補強。
  - `RQ-RDR-019` の影響範囲へ `RQ-UC-009` を追記し、要求追加時の決定記録を同一変更で更新。
- 影響確認:
  - 要求/UC整合: 自動処理（メタデータ再確認）と手動処理（タグ付け）の責務境界がユースケース上でも一意に読める。
  - 運用整合: 再確認失敗時の [[RQ-UC-007]] への遷移導線を保持し、既存運用フローと接続できる。

## 追記（ATへの `RQ-FR-020` 受入展開）
- 対象: `AT-PLAN-001`, `AT-SCN-003`
- 実施:
  - `AT-PLAN-001` の対象範囲へタイムスタンプ表示・該当秒遷移を追加。
  - 判定基準へ [[RQ-FR-020]] の観点（表示、`t=<秒数>` 遷移、未生成時代替表示）を明示。
  - `AT-SCN-003` を「詳細表示・タイムスタンプ遷移」シナリオへ更新し、手順・期待結果・記録項目を具体化。
- 影響確認:
  - 受入整合: 要求追加 [[RQ-FR-020]] からATシナリオまでのトレースが成立。
  - 判定整合: 既存の詳細表示/外部遷移判定に、秒指定遷移と未生成時挙動の判定軸を追加。

## 追記（既存収集UCからの導線補強）
- 対象: `RQ-UC-001`
- 実施:
  - `related` に [[RQ-UC-009]] と [[RQ-FR-019]] を追加し、収集起動から配信前後再確認・手動タグ付け運用までのトレースを明示。
- 影響確認:
  - ユースケース整合: 既存の収集起動シナリオと新規運用シナリオの接続が文書上で追跡可能になった。

## 追記（詳細機能の生成責務をDATへ追加）
- 対象: `RQ-FR-022`, `RQ-FR-023`, `RQ-RDR-022`, `RQ-FR-020`, `RQ-FR-021`, `RQ-SC-001`
- 実施:
  - タイムスタンプ表示用データ生成要求 `RQ-FR-022` を DAT として新規追加。
  - ワードクラウド表示用画像生成要求 `RQ-FR-023` を DAT として新規追加。
  - 表示要求（`RQ-FR-020` / `RQ-FR-021`）と生成要求（`RQ-FR-022` / `RQ-FR-023`）を分離する決定記録 `RQ-RDR-022` を新規作成。
  - `RQ-FR-020` / `RQ-FR-021` の `related` へ生成要求を追記し、責務境界のトレースを補強。
  - `RQ-SC-001` の対象機能と DoD 範囲を `RQ-FR-023` まで更新。
- 影響確認:
  - 要求整合: DET（表示）と DAT（生成）の責務境界が要求文書で一意に読める構成になった。
  - 受入整合: 表示不具合と生成不具合を受入判定時に切り分け可能になった。
  - 制約整合: `RQ-PRC-001` / `RQ-PC-003` の生データ非保存方針を、生成要求側の受入基準へ反映した。

## 追記（プロジェクト名の理由・意図の明文化）
- 対象: `RQ-GL-001`, `RQ-PP-001`
- 実施:
  - `RQ-GL-001` の定義表へ、`diopside` の命名理由（石言葉「幸せへの道標」）と命名意図を追記。
  - `RQ-PP-001` に「プロジェクト名の理由と意図」節を追加し、目的文書から名称の背景を参照可能化。
- 影響確認:
  - 要求整合: スコープ/目的/用語で `diopside` の意味と価値観を一貫して説明できる。
  - 文書運用整合: 命名背景の説明が要求文書内で完結し、レビュー時の解釈差分を低減。

## 追記（UC主体のステークホルダーリンク化）
- 対象: `RQ-UC-007`
- 実施:
  - 本文中の主体「管理者」を [[RQ-SH-001|管理者]] へリンク化し、ステークホルダー定義への参照を明示。
  - frontmatter の `version` を `1.0.4` へ更新し、`updated` と変更履歴を当日更新。
- 影響確認:
  - 要求整合: UC本文からステークホルダー定義へ一意に遷移でき、主体解釈の曖昧さを低減。

## 追記（`RQ-FR-020` の意味変更: タイムスタンプ一覧 -> コメント密度波形）
- 対象: `RQ-FR-020`, `RQ-RDR-020`, `RQ-FR-022`, `RQ-RDR-022`, `RQ-UC-006`, `RQ-SC-001`, `RQ-GL-015`, `RQ-GL-016`, `RQ-DM-008`, `RQ-DM-001`, `BD-ADR-010`, `BD-API-001`, `BD-UI-002`, `BD-UI-004`, `AT-PLAN-001`, `AT-SCN-003`
- 実施:
  - `RQ-FR-020` を「コメント密度波形を表示し盛り上がり区間へ遷移する要求」へ意味変更。
  - `RQ-RDR-020` を更新し、POC（`.workspace/CreateTimestamp`）の密度抽出意図を採用理由として明文化。
  - 用語 `RQ-GL-015`（盛り上がり区間）/ `RQ-GL-016`（コメント密度波形）を新規追加。
  - ドメイン `RQ-DM-008`（盛り上がり区間モデル）を新規追加し、`RQ-DM-001` へ関連追記。
  - 生成要求 `RQ-FR-022` と分離決定 `RQ-RDR-022` を波形データ前提へ更新。
  - 設計は `BD-ADR-010 -> BD-API-001 -> BD-UI-002/004` で、`highlights/{videoId}.json` 契約と波形UI要件へ更新。
  - 受入は `AT-PLAN-001` / `AT-SCN-003` を波形表示・区間クリック遷移観点へ更新。
- 影響確認:
  - 要求整合: 「コメント密度を測定し、高密度区間を残す」という意図が要求本文で直接読める構成になった。
  - 用語/ドメイン整合: UI語彙（波形・区間）とデータ語彙（区間境界・密度指標）が文書横断で一致。
  - 設計/受入整合: 可視化契約、操作仕様、判定観点が一貫して追跡可能。

## 追記（TypeScript型安全方針のBD反映）
- 対象: `BD-BUILD-001`, `BD-ADR-011`, `.opencode/skills/doc-bd-build/SKILL.md`, `.opencode/skills/doc-bd-build/TEMPLATE.md`
- 実施:
  - `BD-BUILD-001` を更新し、TypeScript型安全の標準設定（`strict`、`noUncheckedIndexedAccess`、`exactOptionalPropertyTypes`、`useUnknownInCatchVariables`）と受入基準を追加。
  - `BD-ADR-011` を新規作成し、型安全を `tsconfig` + lint の品質ゲートで標準化する決定を記録。
  - `doc-bd-build` スキルに、型安全方針をBD-BUILD更新時の必須観点として追加。
  - `doc-bd-build` テンプレートに、型安全章立て（tsconfig/lint/受入基準）を追加。
- 影響確認:
  - 要求整合: [[RQ-DEV-001]] の `lint/test/build` 必須化と、型安全ゲートの導入方針が整合。
  - 設計整合: [[BD-BUILD-001]] から [[DD-CODE-001]] への規約展開が可能なトレースを確保。
  - 運用整合: スキル更新により、今後のBD-BUILD更新でも同方針を継続適用できる。

## 追記（NFRと制約の整合条件明確化）
- 対象: `RQ-AV-001`, `RQ-PS-001`, `RQ-OBY-001`, `RQ-INT-001`, `RQ-DATA-001`, `RQ-UX-003`, `RQ-UX-014`, `RQ-UX-016`, `RQ-UX-020`, `RQ-UX-022`, `RQ-UX-023`, `RQ-RDR-023`
- 実施:
  - NFR整合チェックで抽出した要確認項目について、運用時間帯、計測条件、例外条件、MVP適用条件を本文へ追記。
  - `RQ-RDR-023` を新規追加し、制約（`RQ-PC-002` / `RQ-PC-004` / `RQ-PC-006`）とNFRの整合方針を決定記録化。
  - UX要件はスコープ境界に合わせ、管理者向け導線適用・将来拡張適用の条件を明確化。
- 影響確認:
  - 要求整合: 明確な矛盾を追加せず、要確認事項を判定可能条件へ変換。
  - 制約整合: 個人運用体制、APIクォータ制約、月額コスト上限を前提にした運用可能な要件へ補正。
  - 受入整合: 例外時の判定基準が定義され、ATでの再現可能性を向上。

## 追記（スキルメンテナンス方針の要求・設計反映）
- 対象: `RQ-DG-001`, `RQ-DEV-001`, `RQ-RDR-024`, `BD-CM-001`, `BD-ADR-012`, `.opencode/skills/skill-maintainer/SKILL.md`, `.opencode/skills/docops-orchestrator/SKILL.md`, `.opencode/skills/doc-rq-dg/SKILL.md`, `.opencode/skills/doc-bd-cm/SKILL.md`
- 実施:
  - `RQ-DG-001` の改修フローと受入基準に、スキル同一変更・共通スキル同時更新・記録要件を追加。
  - `RQ-DEV-001` の受入基準に、スキル同期と `impact_check/doc_check` 更新を品質ゲートとして追加。
  - `RQ-RDR-024` を新規作成し、スキルメンテナンス方針を要求決定記録として固定。
  - `BD-CM-001` と `BD-ADR-012` を更新し、変更分類ごとの同期設計と同一変更原則を構成管理へ反映。
  - `skill-maintainer` / `docops-orchestrator` / `doc-rq-dg` / `doc-bd-cm` の各スキルに新方針を同期。
- 影響確認:
  - 要求整合: [[RQ-DG-001]] と [[RQ-DEV-001]] で運用手順と品質ゲートが整合。
  - 設計整合: [[RQ-RDR-024]] -> [[BD-ADR-012]] -> [[BD-CM-001]] のトレース経路を確立。
  - 運用整合: 共通規約変更時の最低更新セット（`skill-maintainer` / `docops-orchestrator` / `obsidian-doc-*`）を明文化。

## 追記（FRディレクトリを機能単位へ再編）
- 対象: `docs/1.要求(RQ)/51.機能要求(FR)` 配下23文書（`RQ-FR-001`〜`RQ-FR-023`）
- 実施:
  - 実装工程ベースの分類（収集実行/収集データ整備/一覧表示/検索・絞り込み）から、機能単位の分類へ再編。
  - 新カテゴリ `01.収集対象取り込み(ING)` / `02.検索・絞り込み・並び替え(SCH)` / `03.タグ管理(TAG)` / `04.一覧表示・段階ロード(LST)` / `06.コメント密度波形(HLW)` / `07.ワードクラウド(WCL)` を作成し、関連文書を移動。
  - 既存カテゴリ `05.詳細表示・外部遷移(DET)` は機能区分として継続利用し、`DET` には `RQ-FR-013` / `RQ-FR-014` を配置。
  - `06.運用監視・再実行(OPS)` は番号重複解消のため `08.運用監視・再実行(OPS)` へリネームし、`RQ-FR-016` / `RQ-FR-017` / `RQ-FR-018` を維持配置。
  - 旧カテゴリ `01.収集実行(COL)` / `02.収集データ整備(DAT)` / `03.一覧表示(VIEW)` / `04.検索・絞り込み(FLT)` は空ディレクトリ化後に整理。
- 影響確認:
  - 要求整合: 要求ID・本文・frontmatterを変更せず、文書の意味は不変。
  - トレーサビリティ整合: Obsidianリンクは `[[RQ-FR-xxx]]` のID解決のため、関連文書からの参照は維持。
  - 運用整合: 機能起点での閲覧性が向上し、コメント密度波形/ワードクラウドの表示要求と生成要求を同一機能カテゴリで追跡可能。

## 追記（FR機能単位編成を運用規約・スキル・エージェントへ反映）
- 対象: `AGENTS.md`, `.opencode/skills/doc-rq-fr/*`, `.opencode/skills/docops-orchestrator/SKILL.md`, `.opencode/skills/skill-maintainer/SKILL.md`, `.opencode/skills/obsidian-doc-*/SKILL.md`, `.opencode/agents/docops-orchestrator.md`
- 実施:
  - `AGENTS.md` に FR機能単位編成規約（ING/SCH/TAG/LST/DET/HLW/WCL/OPS）を追加し、生成系要求の配置方針を明文化。
  - `doc-rq-fr` に FR配置規則と曖昧時のRDR記録ルールを追加。
  - `docops-orchestrator` / `skill-maintainer` に FR編成維持の実行手順を追加。
  - `obsidian-doc-new` / `obsidian-doc-change` / `obsidian-doc-check` に FR配置の確認観点を追加。
  - 運用用エージェントとして `.opencode/agents/docops-orchestrator.md` を新規追加。
- 影響確認:
  - 規約整合: FRの再編方針が AGENTS/skills/agents で同一ルールに統一された。
  - 運用整合: 新規FR追加時に実装工程寄り分類へ戻るリスクを低減。
  - トレーサビリティ整合: 配置判断が曖昧な場合のRDR記録ルールを明確化。
  - 検証結果: `validate_vault.py` 実行で `broken_links: 0`、`nonlinked_doc_ids: 68`（UT/IT/AT文書の既存ID未リンク）を確認。

## 追記（FR起点での用語・ドメイン不足補完）
- 対象: `RQ-GL-017`, `RQ-DM-009`, `RQ-FR-021`, `RQ-FR-023`, `RQ-DM-001`, `RQ-RDR-021`
- 実施:
  - WCL要求（[[RQ-FR-021]] / [[RQ-FR-023]]）で中核語彙となる [[RQ-GL-017|ワードクラウド]] を新規追加。
  - WCL成果物の生成・状態・参照を表す [[RQ-DM-009]] を新規追加。
  - [[RQ-FR-021]] / [[RQ-FR-023]] の要求本文と依存・関連へ [[RQ-GL-017]] / [[RQ-DM-009]] を反映。
  - [[RQ-DM-001]] に [[RQ-DM-009]] との関連を追加し、詳細表示導線のモデル整合を補強。
  - 要求決定記録 [[RQ-RDR-021]] に、用語/ドメイン補完の影響範囲を追記。
- 影響確認:
  - 要求整合: FRで使用する語彙（ワードクラウド）の定義がGLで一意に参照可能となった。
  - ドメイン整合: HLWの [[RQ-DM-008]] に対し、WCL側も [[RQ-DM-009]] で対になるモデルを保持。
  - トレーサビリティ整合: `FR -> GL/DM -> RDR` の参照経路を補完し、レビュー時の解釈差分を低減。

## 追記（pre-commitとTaskfileのdocs運用整備）
- 対象: `Taskfile.yaml`, `.pre-commit-config.yaml`, `AGENTS.md`, `README.md`
- 実施:
  - docs運用専用の `Taskfile.yaml` を追加し、`precommit` / `docs:guard` / `docs:check` などの標準入口を定義。
  - `docs:autolink:changed` / `docs:check:changed` を追加し、差分docsだけを対象にリンク補正と整合検査を実行可能化。
  - `.pre-commit-config.yaml` に汎用フック（`pre-commit-hooks`）を追加し、既存のdocs専用ローカルフックと併用。
  - `AGENTS.md` の変更フローを `task docs:guard` / `task docs:check` 中心へ更新し、`README.md` に運用コマンドを追記。
- 影響確認:
  - 運用整合: docs更新時の手順が Task 入口に統一され、実行漏れリスクを低減。
  - 品質整合: pre-commitで一般的なフォーマット/YAML整合を早期検知可能。
  - 拡張整合: docs専用タスク構成のため、既存Web/他作業フローへの影響を最小化。

## 追記（本文IDリンクのfail運用導入と残件解消）
- 対象: `.opencode/skills/obsidian-doc-check/scripts/validate_vault.py`, `.pre-commit-config.yaml`, `.github/workflows/docs-link-check.yml`, `RQ-DG-001`, `UT-PLAN-001`, `IT-PLAN-001`, `AT-GO-001`, `AT-RPT-001`
- 実施:
  - `validate_vault.py` を拡張し、本文中の未リンク文書IDを `nonlinked_doc_ids` として検出し fail とする運用を追加。
  - `--targets` を追加し、差分文書のみを厳格検査できるようにした。
  - pre-commit と CI に同一検査ゲート（用語リンク + 本文IDリンク）を追加。
  - `RQ-DG-001` の改修フローと受入基準に、リンク検査ゲートと fail 条件を反映。
  - 残件だったUT/IT/AT文書の本文ID参照を `[[ID]]` へ統一（`UT-PLAN-001`, `IT-PLAN-001`, `AT-GO-001`, `AT-RPT-001`）。
- 影響確認:
  - 運用整合: ローカルコミットとPRの双方で同一ルールによりリンク不備をブロック可能。
  - トレーサビリティ整合: テスト計画/判定/報告の表・本文から関連IDへ直接遷移可能。
  - 検証結果: `validate_vault.py --docs-root docs --report reports/doc_check.md` 実行で `nonlinked_doc_ids: 0` を確認。

## 追記（単一CloudFront配下のURL分岐設計追加）
- 対象: `RQ-FR-025`, `RQ-RDR-026`, `BD-ADR-014`, `BD-DEP-004`, `BD-API-004`, `DD-DEP-002`, `DD-API-010`, `AT-SCN-006`, `RQ-SC-001`, `RQ-DEV-001`, `RQ-SEC-001`, `RQ-INT-001`, `AT-REL-001`, `AT-RUN-001`
- 実施:
  - 新規文書で、単一CloudFront Distribution上の経路分離（`/web/*`, `/docs/*`, `/openapi/*`, `/api/v1/*`）を要求・設計・受入まで定義。
  - 版対応を `/openapi/v1/openapi.json` と `/api/v1/*` で固定し、認証境界を `/openapi/*` と `/api/v1/*` に設定。
  - 既存文書は最小更新として、DoD範囲・非機能受入基準・配信/障害対応手順へ追記のみ実施。
- 影響確認:
  - 要求整合: `RQ-RDR-026 -> RQ-FR-025` で意思決定と要求本文が整合。
  - 設計整合: `BD-ADR-014 -> BD-DEP-004/BD-API-004 -> DD-DEP-002/DD-API-010` の経路でトレース可能。
  - 運用整合: `AT-SCN-006`、`AT-REL-001`、`AT-RUN-001` で経路競合・認証障害の検証と復旧を再現可能。

## 追記（ドキュメント公開フロー要求とQuartz+CDK設計の追加）
- 対象: `RQ-FR-024`, `RQ-RDR-025`, `RQ-DEV-001`, `RQ-SC-001`, `BD-ADR-013`, `BD-DEP-003`, `DD-DEP-001`, `AT-PLAN-001`, `AT-REL-001`, `AT-RUN-001`
- 実施:
  - 公開運用要求 `RQ-FR-024` を新規追加し、`task docs:deploy` を単一入口とする受入基準を定義。
  - 要求決定記録 `RQ-RDR-025` を新規作成し、Quartz build + CDK deploy + invalidationの標準化を決定。
  - 設計決定 `BD-ADR-013` と設計本文 `BD-DEP-003` を新規追加し、`siteAssetPath`、S3+OAC、pretty URL rewrite、失敗時観点を明文化。
  - `DD-DEP-001` を意味変更し、公開フロー詳細（I/O、解決パス、障害ハンドリング）へ更新。
  - 受入運用文書 `AT-REL-001` / `AT-RUN-001` と計画 `AT-PLAN-001` を公開手順前提へ更新。
  - `RQ-DEV-001` と `RQ-SC-001` を更新し、DevOps品質ゲートとDoD範囲を [[RQ-FR-024]] まで拡張。
- 影響確認:
  - 要求整合: [[RQ-PC-005]]（AWS配信基盤）と [[RQ-PC-009]]（小差分リリース）の制約を、公開運用要求で具体化できた。
  - 設計整合: [[RQ-RDR-025]] -> [[BD-ADR-013]] -> [[BD-DEP-003]] -> [[DD-DEP-001]] のトレース経路を構築。
  - 受入整合: 公開手順と障害復旧の判定を [[AT-REL-001]] / [[AT-RUN-001]] で再現可能化。

## 追記（CornellNoteWeb準拠の公開設計整理）
- 対象: `RQ-RDR-025`, `BD-ADR-013`, `BD-DEP-003`, `DD-DEP-001`, `BD-DEP-004`, `DD-DEP-002`
- 実施:
  - `.workspace/CornellNoteWeb` の運用原則（Task入口統一/IaC配備/運用手順明文化）をdiopside公開設計へ明記。
  - 公開方式をPhase 1（docs単独公開）/ Phase 2（単一CloudFront分岐拡張）で段階化。
  - `BD-DEP-003` と `DD-DEP-001` に `docs-link-check` と `docs-deploy` の責務分離、および `docs:deploy` 実行チェーンを設計として追加。
  - `BD-DEP-004` / `DD-DEP-002` にPhase 2適用条件（Phase 1安定化前提）を追加。
- 影響確認:
  - 運用整合: 先行公開で運用安定化してから経路分岐へ拡張するため、段階導入リスクを低減。
  - 設計整合: RDR/ADR/BD/DDで同じ段階導入方針を参照できる状態へ統一。

## 追記（AWSタグ統制の要求・設計反映: 単一アカウント前提）
- 対象: `RQ-COST-001`, `RQ-SEC-001`, `RQ-RDR-027`, `BD-ADR-015`, `DD-COST-001`
- 実施:
  - `RQ-COST-001` に必須タグセット（`CostCenter`/`Environment`/`Owner`/`Project`/`ManagedBy`）、列挙値制約、コスト配分タグ有効化遅延を考慮した受入基準を追加。
  - `RQ-SEC-001` にタグへのPII/秘密情報禁止、`aws:` プレフィックス禁止、大小文字表記ゆれ統制の受入基準を追加。
  - 要求判断を `RQ-RDR-027` として新規作成し、Organizations前提を置かない単一アカウント方針を明文化。
  - 設計判断を `BD-ADR-015` で新規作成し、IaC + IAM + Config の3層統制を採用。
  - `DD-COST-001` を意味変更し、タグ辞書、強制/検知フロー、Billing運用、是正SLAを具体化。
- 影響確認:
  - 要求整合: [[RQ-PC-006]] のコスト上限制約と、タグ統制に関する運用条件が同時に判定可能になった。
  - 設計整合: [[RQ-RDR-027]] -> [[BD-ADR-015]] -> [[DD-COST-001]] の追跡経路を構築。
  - 運用整合: タグ欠落/禁止情報混入の是正記録を [[AT-OPS-001]] へ集約できる構成を維持。

## 追記（PoC参照によるメタデータ取得方式・構成・要求の整理）
- 対象: `RQ-RDR-028`, `RQ-FR-001`, `RQ-FR-003`, `RQ-FR-004`, `RQ-FR-019`, `RQ-DATA-001`, `RQ-UC-001`, `BD-ARCH-001`, `BD-API-002`, `BD-DATA-001`
- 実施:
  - `.workspace/get-archives-info.zip` を参照し、取得業務を「公式取り込み/出演補完取り込み/差分更新」の3モードへ分離する決定記録 `RQ-RDR-028` を新規作成。
  - `RQ-FR-001` に3モード起動と更新種別（新規/既存/補完/再確認）の記録要件を追加。
  - `RQ-FR-003` に出演候補ID集合を用いた補完取り込みを追加（具体形式は固定しない）。
  - `RQ-FR-004` に必須属性/任意属性の分離と、任意欠損の補完対象識別を追加。
  - `RQ-FR-019` に責務境界（配信前後再確認と全体差分更新の分離）を明記。
  - `RQ-DATA-001` に取得元区分・更新種別の追跡記録を受入基準として追加。
  - `RQ-UC-001`、`BD-ARCH-001`、`BD-API-002`、`BD-DATA-001` を更新し、取得モード分離とデータ層構成を設計へ反映。
- 影響確認:
  - 要求整合: `FR/UC/RDR` で収集モードと責務境界が一意に読める構成を維持。
  - 設計整合: `RQ-RDR-028 -> BD-ARCH-001 -> BD-API-002/BD-DATA-001` のトレース経路を構築。
  - 制約整合: `RQ-PC-003` / `RQ-PRC-001` に合わせ、コメント/チャット/字幕の恒久保存を採用しない境界を維持。

## 追記（cdk-nag除外理由の設計明文化）
- 対象: `BD-DEP-003`, `DD-DEP-001`, `AT-RUN-001`
- 実施:
  - `BD-DEP-003` に cdk-nag 品質ゲートと、Phase 1で許可する除外ID（`IAM4/IAM5/L1/S1/CFR1/CFR2/CFR3/CFR4`）の適用方針を追加。
  - `DD-DEP-001` に除外IDごとの対象・理由・再評価条件、および cdk-nag 失敗時の運用ルールを追加。
  - `AT-RUN-001` に cdk-nag 失敗の障害分類と、`DD-DEP-001` への同時反映を含む復旧手順を追加。
- 影響確認:
  - 設計整合: cdk-nagの除外理由がコード（`infra/lib/quartz-site-stack.ts`）と文書（BD/DD/AT）で一致。
  - 運用整合: 新規除外追加時に、実装だけでなく設計文書更新を必須化できる状態を確認。

## 追記（Phase 1経路と実装経路の整合補正）
- 対象: `infra/functions/pretty-url-rewrite.js`, `Taskfile.yaml`, `AT-REL-001`
- 実施:
  - CloudFront Functionに `/docs/*` 互換リライトを追加し、`/docs/` から公開トップへ到達できるよう修正。
  - `docs:verify` を `/` と `/docs/` の双方確認へ更新。
  - `AT-REL-001` をPhase 1（docs先行公開）基準へ修正し、Phase 2の経路確認を条件付き手順へ分離。
- 影響確認:
  - 経路整合: `BD-DEP-003` の Phase 1 方針（docs公開）と運用手順の参照経路が一致。
  - 互換性: 既存の `/` アクセスを維持しつつ、`/docs/*` 導線でも同等到達を確認可能。

## 追記（AWS CDKベストプラクティスの設計・スキル反映）
- 対象: `RQ-RDR-029`, `BD-ADR-016`, `RQ-DEV-001`, `BD-BUILD-001`, `BD-DEP-003`, `DD-DEP-001`, `.opencode/skills/doc-rq-dev/*`, `.opencode/skills/doc-bd-build/*`, `.opencode/skills/doc-bd-dep/*`, `.opencode/skills/doc-dd-dep/*`
- 実施:
  - 要求決定記録 `RQ-RDR-029` を新規追加し、CDK設計標準（`synth` 決定性、Construct中心、stateful分離、props注入、`cdk.context.json` 固定）を採用決定として記録。
  - 設計決定 `BD-ADR-016` を新規追加し、非採用案（Stack中心実装、`process.env` 直参照、物理名固定）を明示。
  - `RQ-DEV-001` の受入基準へCDK品質ゲート（`cdk synth` 再現性、context管理、論理ID置換防止）を追加。
  - `BD-BUILD-001` / `BD-DEP-003` / `DD-DEP-001` を更新し、決定性・CIゲート・CDKテスト方針（fine-grained/snapshot/integ）を反映。
  - 対応 `doc-*` スキルと `TEMPLATE.md` を同一変更で更新し、以後の文書更新で同観点が漏れないように同期。
- 影響確認:
  - 要求整合: [[RQ-PC-009]] の小差分リリース制約に対し、CDK運用の判定可能条件が追加された。
  - 設計整合: [[RQ-RDR-029]] -> [[BD-ADR-016]] -> [[BD-BUILD-001]]/[[BD-DEP-003]] -> [[DD-DEP-001]] の追跡経路を構築。
  - スキル整合: `doc-rq-dev` / `doc-bd-build` / `doc-bd-dep` / `doc-dd-dep` が同一のCDK品質観点を保持。

## 追記（Quartzデフォルトホームへの移行）
- 対象: `docs/index.md`, `docs/RQ-HM-001.md`, `infra/functions/pretty-url-rewrite.js`, `infra/test/fixtures/site/index.html`, `BD-DEP-003`, `DD-DEP-001`, `AT-REL-001`
- 実施:
  - ホーム文書を `RQ-HM-001` から `index` へ移行し、公開トップの正本を Quartz デフォルト (`index.md`) に統一。
  - CloudFront Function の `"/"` と `"/docs/"` リライト先を `index.html` へ変更。
  - infra のテストフィクスチャを `RQ-HM-001.html` から `index.html` へ置換。
  - 設計文書と配信手順書の公開トップ参照を `index.html` / [[index]] 前提へ更新。
- 影響確認:
  - 経路整合: ルートアクセスと docs プレフィックスアクセスが同一トップへ解決される。
  - 設計整合: BD/DD/AT の参照先が実装のルーティング仕様と一致する。

## 追記（AIエージェント運用要求と設計の追加）
- 対象: `RQ-DEV-002`, `RQ-RDR-029`, `BD-ARCH-005`, `BD-ADR-016`
- 実施:
  - AIエージェント運用を非機能要求として `RQ-DEV-002` に新規追加し、役割分離・最小権限・実行上限を受入基準化。
  - 要求採用理由と影響範囲を `RQ-RDR-029` に記録。
  - 運用アーキテクチャを `BD-ARCH-005` に新規追加し、Primary/Subagent分離と成果物トレースをMermaidで明示。
  - 設計判断を `BD-ADR-016` に新規追加し、段階解放とホワイトリスト運用を採用決定として固定。
- 影響確認:
  - 要求整合: `RQ-PC-007` / `RQ-PC-009` のAI支援開発制約を、判定可能な運用要件へ具体化。
  - 設計整合: `RQ-RDR-029 -> BD-ADR-016 -> BD-ARCH-005` の追跡経路を構築。
  - 運用整合: 既存の文書運用規約（`BD-CM-001`, `RQ-DG-001`）と矛盾しない更新単位を維持。

## 追記（エージェント実体定義への反映とDevOps要件束ね）
- 対象: `.opencode/agents/review.md`, `.opencode/agents/security-auditor.md`, `.opencode/agents/orchestrator.md`, `RQ-DEV-001`
- 実施:
  - `review` / `security-auditor` を read-only 監査系サブエージェントとして追加し、`edit: deny` と最小bash許可を設定。
  - `orchestrator` をPrimaryとして追加し、`permission.task` をホワイトリスト方式（`explore`/`review`/`security-auditor`）で定義。
  - `RQ-DEV-001` に [[RQ-DEV-002]] 参照を追加し、AIエージェント運用要件をDevOps要件に統合。
- 影響確認:
  - 運用整合: 役割分離・最小権限・段階解放の方針が文書と実体定義の双方で一致。
  - 要求整合: `RQ-DEV-001` から `RQ-DEV-002` を辿れるため、DevOps品質ゲート内でAI運用要件を判定可能。

## 追記（本文リンクのコード化解消）
- 対象: `docs/**`, `reports/impact_check_2026-02-11.md`
- 実施:
  - 本文中でコード化されていたObsidianリンク（例: `[[RQ-FR-001]]`）を、リンク解決可能な `[[RQ-FR-001]]` 形式へ統一。
  - 依頼対象の [[RQ-FR-019]] を優先して修正し、同種パターンを要求/設計/詳細設計/受入テスト文書へ横展開。
  - 記法説明として意図したプレースホルダー（例: `` `[[ID]]` ``, `` `[[RQ-FR-xxx]]` ``）は維持。
- 影響確認:
  - 要求整合: [[RQ-FR-019]] の責務境界参照（[[RQ-FR-001]]）が本文から直接遷移可能。
  - トレーサビリティ整合: RQ/BD/DD/AT と impact_check の相互参照でリンク切れを解消。
  - 運用整合: 本文IDリンクのfail運用（`RQ-DG-001`）と整合する記法へ是正。

## 追記（「ページング済み索引」用語の定義とリンク統一）
- 対象: `RQ-FR-006`, `RQ-GL-009`, `BD-API-001`, `DD-API-001`, `DD-API-004`
- 実施:
  - `RQ-FR-006` の要求本文「ページング済み索引」を [[RQ-GL-009|ページング済み索引（archive_index）]] へリンク化。
  - `RQ-GL-009` に別名「ページング済み索引」を追加し、`related` へ [[RQ-FR-006]] を追記。
  - `BD-API-001` の `archive_index.p{page}.json` 契約を [[RQ-GL-009|archive_index]] 表記へ統一し、主な利用要求へ [[RQ-FR-006]] を追加。
  - `DD-API-001` / `DD-API-004` のページング索引表現を [[RQ-GL-009]] 参照に統一。
- 影響確認:
  - 用語整合: FR/GL/BD/DD の横断で「ページング済み索引」= `archive_index` の対応が一意に追跡可能。
  - トレーサビリティ整合: `RQ-FR-006 -> RQ-GL-009 -> BD-API-001 -> DD-API-001/DD-API-004` の参照経路を補強。

## 追記（段階ロード要求の目的明確化）
- 対象: `RQ-FR-015`, `RQ-RDR-002`
- 実施:
  - `RQ-FR-015` の要求文を「初回読み込み高速化のため段階ロードで漸進表示する」表現へ更新。
  - 受入基準/例外/テスト観点を、待機理由の可視化・失敗時の次操作提示・重複/逆順化防止まで具体化。
  - 意味変更に伴い `RQ-RDR-002` を更新し、初回表示を最小表示単位先行とする決定を追記。
- 影響確認:
  - 要求整合: 一覧表示の目的（初回待機短縮）と手段（段階ロード）が同一文脈で判定可能。
  - 決定整合: `RQ-RDR-002 -> RQ-FR-015` の追跡経路で、採用理由と要求本文の一致を確認。
