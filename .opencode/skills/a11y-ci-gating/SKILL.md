---
name: a11y-ci-gating
description: CI/CDでアクセシビリティ自動検査とQuality Gateを構築し、回帰を防ぐ（手動ゲート併用前提）
compatibility: opencode
metadata:
  standard: WCAG-2.2
  level: AA
  lang: ja
  area: ci-gating
---

# a11y-ci-gating

## 目的
クラウド前提の開発（CI/CD）で、アクセシビリティ品質を “後追い” ではなく **継続的に担保**するための自動検査とゲート（Quality Gate）を整備します。
自動検査だけでは不十分ですが、最低限の欠陥を早期に検出し、回帰を防ぎます。

## 対象となる達成基準（WCAG 2.2）
- 自動検査でカバーしやすい項目（例: Name/Role/Value、ラベル、コントラストの一部、ARIA属性整合）を中心に、A/AA全般の “最低ライン” を継続担保
- 手動検証が必須の項目（2.4.11、2.5.7、3.3.8等）は **自動だけで完結しない** ことを明記し、手動ゲートと併用

## 入力として必要な情報
- リポジトリ構成（フロントエンド/バックエンド、ビルド手段）
- CI基盤（GitHub Actions/GitLab CI/Cloud Build等）
- テスト手段（Playwright/Cypress/Jest等）
- 対象URL（Preview環境/Storybook/静的ビルド）

## 推奨するCI構成（段階的に導入）
### 1) 静的解析（PRごと）
- フロントエンドlint（例: JSX a11y ルール、HTML検証、ARIAルール）
- デザイントークン逸脱（色直書き等）を検知するルール（可能なら）

### 2) コンポーネント単位の検査（PRごと）
- Storybook等がある場合:
  - コンポーネントごとに axe 走査（ルール/閾値を調整）
- ない場合:
  - 代表コンポーネントの単体レンダリング + axe（jest-axe等）を検討

### 3) E2Eでの自動検査（PRごと or 夜間）
- Playwright/Cypress等で主要画面へ遷移し、axe 走査
- “重大（critical）” だけはPRで落とし、その他は計画的に改善する運用（段階導入）

### 4) 定期スキャン（夜間/週次）
- 主要導線のURLを対象に、スケジュール実行で回帰監視
- 結果をアーティファクト保存し、改善トレンドを追えるようにする

## ゲート設計の原則
- いきなり全ルールで落とすと運用破綻しやすい
  - まず “新規導入で増えた違反” を防ぐ（baseline）
  - 重大違反だけブロック、残りはバックログで改善
- “手動が必要な項目” のチェックが抜けないように、PRテンプレやリリースチェックリストに組み込む

## 成果物（このスキルのアウトプット）
- CIジョブ定義（例: `a11y-lint`, `a11y-e2e`, `a11y-report`）
- 失敗条件（どのレベルで落とすか、例外運用）
- レポート出力（HTML/JSONなど）と保存先
- リリースチェックリストへの追記（手動ゲート含む）

## 受入基準 / Definition of Done
- PRで最低限のアクセシビリティ自動検査が実行される
- 重大違反はCIで検出され、回帰が防止される
- 定期スキャンで傾向が把握できる（少なくともレポートが残る）
- 自動でカバーできない項目は、手動ゲートとして明文化されている

## よくある落とし穴
- 自動検査の “0件” をゴールにして、誤検知除外が増えて形骸化
- 重要フロー（認証、フォーム、モーダル）をE2E対象に含めていない
- レポートが保存されず、回帰に気づけない
