---
name: a11y-forms-errors
description: フォーム入力/送信を伴うUI（登録・認証・決済・設定など）を設計・実装・改修する際に、ラベル/エラー/ステータス通知と冗長入力防止・一貫ヘルプをWCAG 2.2 AA相当で実装する
compatibility: opencode
metadata:
  standard: WCAG-2.2
  level: AA
  lang: ja
  area: forms-errors
---

# a11y-forms-errors

## 目的
フォーム入力体験をWCAG 2.2 AA相当で担保し、入力ミスの発見・修正・再試行が支援技術でも確実に行えるようにします。
WCAG 2.2で追加された **3.3.7 Redundant Entry（A）** と **3.2.6 Consistent Help（A）** を含め、認証・登録・決済・設定画面などの重要フローの品質を底上げします。

## 対象となる達成基準（WCAG 2.2）
- 1.3.1 情報及び関係性（A）
- 1.3.5 入力目的の特定（AA）
- 3.3.1 エラーの特定（A）
- 3.3.2 ラベル又は説明（A）
- 3.3.3 エラー修正の提案（AA）
- 3.3.4 エラー防止（法的、金融、データ）（AA）
- 3.3.7 冗長な入力（A）【WCAG 2.2追加】
- 3.2.6 一貫したヘルプ（A）【WCAG 2.2追加】
- 4.1.3 ステータスメッセージ（AA）
- （関連）2.4.6 見出し及びラベル（AA）

## このスキルを使う条件
- フォーム入力と検証エラーが発生するUI（登録、ログイン、プロフィール編集、配送先入力、決済など）を扱う
- 同一プロセス内で同一情報の再入力が起きうる、またはヘルプ導線の一貫性を担保したい
- `label`/`aria-describedby`/`aria-live` などを含む実装・レビューを行う

## このスキルを使わない条件
- 読み取り専用画面のみで、ユーザー入力・送信・バリデーションが存在しない
- 主課題がフォーム以外（例: フォーカス遷移、色コントラスト、メディア代替）で、別スキルが中心になる

## 出力契約
- 対象フローごとに、該当達成基準（1.3.1/1.3.5/3.3.x/3.2.6/4.1.3）への対応方針を明示する
- ラベル/説明関連付け、エラー提示、ステータス通知、冗長入力回避、一貫ヘルプの実装差分または修正案を提示する
- キーボード操作とスクリーンリーダー確認を含む最小の検証結果（または実施手順）を残す

## 入力として必要な情報
- フォーム項目一覧（必須/任意、型、制約、例、エラーメッセージ方針）
- 入力フロー（複数ステップか、同一情報の再入力があるか）
- 認証/本人確認/決済などの高重要度フローの有無

## 実施手順
### 1) ラベル/説明をプログラム的に関連付ける（3.3.2, 1.3.1）
- 入力要素に対して `label`（`for` または内包）を必須とする
- 補足説明は `aria-describedby` 等で関連付ける（説明の表示/非表示と同期）
- プレースホルダーをラベル代替にしない（消える/コントラスト不足になりがち）

### 2) 入力目的の特定（1.3.5）
- 可能な項目は `autocomplete` を付与（例: `name`, `email`, `username`, `postal-code`）
- パスワードマネージャ・OS補完が効くように設計（認証要件とも整合）

### 3) エラー提示（3.3.1, 3.3.3）
- どの項目がエラーかを明示（色だけでなくテキストでも）
- エラーメッセージは具体的に（何が問題で、どう直すか）
- エラー発生時のUX:
  - フォーカスを適切に誘導（フォーム先頭のエラー概要へ飛ばす等）
  - ただし、突然のフォーカス移動で迷子にしない（規約で統一）

### 4) ステータスメッセージ（4.1.3）
- 保存完了/送信失敗/検証中など、画面上の状態変化は支援技術にも通知する
  - 例: `aria-live` 領域、`role="status"`, `role="alert"` の使い分け
- トースト通知はキーボード・スクリーンリーダーで把握できる設計に（自動消滅の扱いに注意）

### 5) 高リスク操作のエラー防止（3.3.4）
- 法的/金融/データの確定操作は、少なくとも以下のいずれかを提供:
  - 確認画面
  - 取消（Undo）
  - 入力内容のレビュー/修正機会

### 6) 冗長な入力を避ける（3.3.7）
- 同一プロセス内で、既に入力済みの情報を再入力させない
  - 例: 住所・氏名を複数画面で再入力させる、等
- どうしても必要なら、ユーザーの操作で自動入力できる選択肢を提供（例: “請求先と同じ”）

### 7) 一貫したヘルプ（3.2.6）
- ヘルプ（FAQ、チャット、問い合わせ、ヘルプリンク）がある場合:
  - 同一プロセス内で **位置・ラベル・アクセス方法** を一貫させる
- 画面によってヘルプ導線が消える/移動する場合は、例外の根拠を明記

## 受入基準 / Definition of Done
- すべての入力にラベルがあり、支援技術が項目名・必須/任意・エラー内容を把握できる
- エラーは色のみに依存せず、修正方法が分かる
- 送信/保存などの状態変化が支援技術へ通知される（4.1.3）
- 同一プロセス内の再入力が不要、またはユーザーが容易に回避できる（3.3.7）
- ヘルプ導線がプロセス内で一貫している（3.2.6）

## 手動テスト手順（最小セット）
- 必須項目未入力で送信→エラー箇所へ到達し、修正して再送できる（キーボードのみ）
- スクリーンリーダーでラベル/説明/エラー/ステータスが読み上げられる
- “同じ情報の再入力” が発生しないことを主要フローで確認

## よくある落とし穴
- エラーを赤枠だけで示す（テキスト説明がない）
- トーストが自動で消え、支援技術が認識できない
- 複数ステップで同一項目を再入力させる（3.3.7違反）
- ヘルプ導線が画面によって位置も名称も変わる（3.2.6違反）
