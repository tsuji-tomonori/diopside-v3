---
name: a11y-color-contrast
description: 色のみに依存しない表現と、テキスト/非テキストのコントラスト要件をWCAG 2.2 AA相当で満たす
compatibility: opencode
metadata:
  standard: WCAG-2.2
  level: AA
  lang: ja
  area: color-contrast
---

# a11y-color-contrast

## 目的
色・コントラストに関するWCAG要件を満たし、低視力・色覚多様性・屋外利用などの条件でも識別可能なUIを実装します。
クラウドアプリで多い「淡いトークン」「境界線が見えない入力欄」「フォーカスリングが背景に埋もれる」等を、デザインシステムのトークン設計と実装ガードで防ぎます。

## 対象となる達成基準（WCAG 2.2）
- 1.4.1 色の使用（A）
- 1.4.3 コントラスト（最低限）（AA）
- 1.4.11 非テキストコントラスト（AA）
- （関連）2.4.7 フォーカスの可視化（AA）、1.4.13 ホバー又はフォーカス時のコンテンツ（AA）

## 入力として必要な情報
- デザイントークン（色/タイポ/境界線/フォーカスリング）
- テーマ（ライト/ダーク）と適用範囲
- 対象UI（テキスト、アイコン、ボタン、入力枠、グラフ、状態バッジ等）

## 実施手順
### 1) テキストのコントラスト（1.4.3）を満たす
- 通常テキスト: **4.5:1** 以上
- 大きなテキスト: **3:1** 以上（サイズ/太さの定義はチーム規約に従う）
- プレースホルダー、補足文、無効状態テキストなども対象（例外扱いにしない）

### 2) 非テキストコントラスト（1.4.11）を満たす
対象:
- UIコンポーネントの視覚的境界（入力欄の枠線、ボタン境界、チェック状態等）
- 状態を伝えるアイコン/境界/線/グラフ要素 など

基準（代表例）:
- UIコンポーネントやグラフィックの識別に必要な部分は **3:1** 以上を目安に設計

### 3) 色だけで情報を伝えない（1.4.1）
- エラー: 赤色だけでなく、**テキスト/アイコン/形状/説明文**で示す
- 必須: 色 + “必須” などのテキスト、または `aria-required` 等（実装と整合）
- グラフ: パターン/ラベル/値表示などで色依存を回避

### 4) フォーカスリングの視認性を担保する
- フォーカスリングの太さ/オフセットを確保（背景と分離）
- 背景色や境界線と同化する場合は、色トークンを見直す
- `:focus-visible` と整合し、マウス操作では過剰に出さないが、キーボードでは必ず出す

### 5) 実装・運用（トークン管理）
- “勝手に色を直書き” を防ぐ: トークン以外をlintで検知する等
- テーマ追加時は、コントラスト検証をCIに組み込む
- デザイン段階でコントラストNGを検出できるプロセス（Figma等）を持つ

## 受入基準 / Definition of Done
- 主要画面の本文・ラベル・操作要素テキストが 4.5:1（大きなテキストは3:1）を満たす
- 入力枠やボタン境界など、識別に必要な非テキスト要素が十分なコントラストを持つ
- 色だけで状態を伝えていない（エラー/成功/警告など）
- フォーカスリングが背景に埋もれない（2.4.7にも寄与）

## 手動テスト手順（最小セット）
- ダークテーマ/ライトテーマ双方で、主要UIの境界とテキストが視認できる
- 色覚シミュレーション（OS機能やブラウザ拡張等）で、エラー/必須/状態が識別できる

## よくある落とし穴
- プレースホルダーをラベル代替にし、かつ薄すぎて読めない
- 無効状態を “薄くするだけ” で、境界が消える
- フォーカスリングをアウトライン無しで表現し、背景に埋もれる
